FROM mariadb:11.8

ARG BASE_DIR

COPY SQL/0000-00-00-schema.sql                /docker-entrypoint-initdb.d/0000-00-00-schema.sql
COPY SQL/0000-00-01-Modules.sql               /docker-entrypoint-initdb.d/0000-00-01-Modules.sql
COPY SQL/0000-00-02-Permission.sql            /docker-entrypoint-initdb.d/0000-00-02-Permission.sql
COPY SQL/0000-00-03-ConfigTables.sql          /docker-entrypoint-initdb.d/0000-00-03-ConfigTables.sql

COPY raisinbread/instruments/instrument_sql/aosi.sql             /docker-entrypoint-initdb.d/aosi.sql
COPY raisinbread/instruments/instrument_sql/bmi.sql              /docker-entrypoint-initdb.d/bmi.sql
COPY raisinbread/instruments/instrument_sql/medical_history.sql  /docker-entrypoint-initdb.d/medical_history.sql
COPY raisinbread/instruments/instrument_sql/mri_parameter_form.sql /docker-entrypoint-initdb.d/mri_parameter_form.sql
COPY raisinbread/instruments/instrument_sql/radiology_review.sql /docker-entrypoint-initdb.d/radiology_review.sql

COPY test/test_instrument/testtest.sql       /docker-entrypoint-initdb.d/test_instrument.sql

# Post-load SQL
RUN echo "USE LorisTest;" >> /docker-entrypoint-initdb.d/0001-paths.sql \
 && echo "UPDATE Config SET Value='${BASE_DIR}/' WHERE ConfigID=(SELECT ID FROM ConfigSettings WHERE Name='base');" >> /docker-entrypoint-initdb.d/0001-paths.sql \
 && echo "GRANT UPDATE,INSERT,SELECT,DELETE,DROP,CREATE TEMPORARY TABLES ON LorisTest.* TO 'SQLTestUser'@'%' IDENTIFIED BY 'TestPassword' WITH GRANT OPTION;" >> /docker-entrypoint-initdb.d/0004-sql-user.sql

