Array.prototype.min=function(){var b=50000;if(this.length>b){var a=[];for(var c=0;c<this.length;c+=b){a.push(Math.min.apply(Math,this.slice(c,c+b-1)))}}else{return Math.min.apply(Math,this)}return a.min()};Array.prototype.max=function(d){var b=50000;if(this.length>b){var a=[];for(var c=0;c<this.length;c+=b){a.push(Math.max.apply(Math,this.slice(c,c+b-1)))}}else{return Math.max.apply(Math,this)}return a.max()};function cloneArray(b){var c=new Array(b.length);for(var a=0;a<c.length;a++){c[a]=b[a]}return c}function rotateUint16Array90Left(f,d,a){var e=new Uint16Array(d*a);for(var c=0;c<d;c++){for(var b=0;b<a;b++){e[c*a+b]=f[b*d+(d-c)]}}return e}function rotateUint16Array90Right(f,d,a){var e=new Uint16Array(d*a);for(var c=0;c<d;c++){for(var b=0;b<a;b++){e[c*a+b]=f[(a-b)*d+c]}}return e}function interpolateDataArray(g,c,b,a){console.log(g.values.length);var e=g.values.length;var f=new Array(e);console.log("Percentage: "+b);for(var d=0;d<e;d++){if(a){f[d]=(g.values[d]*(100-b*100)+c.values[d]*(b*100))/100}else{f[d]=(g.values[d]*(100-b*100)+c.values[d]*(b*100))/100}}console.log(f.length);return f}function Minc(b,a,f){if(!a){a={}}console.log(a);var c=this,e=a.getRawDataParam||"raw_data=true",d=a.getHeaderParam||"minc_headers=true";this.load_headers=function(h){var i=d.split("="),g={};g[i[0]]=i[1];$.ajax({url:h,dataType:"json",data:g,async:false,success:function(j){c.header=j;c.order=j.order;if(c.order.length==4){c.order=c.order.slice(1,c.order.length);c.time=j.time}c.xspace=j.xspace;c.yspace=j.yspace;c.zspace=j.zspace;c.xspace.name="xspace";c.yspace.name="yspace";c.zspace.name="zspace";c.xspace.space_length=parseFloat(c.xspace.space_length);c.yspace.space_length=parseFloat(c.yspace.space_length);c.zspace.space_length=parseFloat(c.zspace.space_length);c.xspace.start=parseFloat(c.xspace.start);c.yspace.start=parseFloat(c.yspace.start);c.zspace.start=parseFloat(c.zspace.start);c.xspace.step=parseFloat(c.xspace.step);c.yspace.step=parseFloat(c.yspace.step);c.zspace.step=parseFloat(c.zspace.step);if(c.order.length==4){c.time.space_length=parseFloat(c.time.space_length);c.time.start=parseFloat(c.time.start);c.time.step=parseFloat(c.time.step)}c[c.order[0]].height=parseFloat(c[c.order[1]].space_length);c[c.order[0]].height_space=c[c.order[1]];c[c.order[0]].length=parseFloat(c[c.order[2]].space_length);c[c.order[0]].length_space=c[c.order[2]];c[c.order[0]].width=parseFloat(c[c.order[2]].space_length);c[c.order[0]].width_space=c[c.order[2]];c[c.order[1]].height=parseFloat(c[c.order[2]].space_length);c[c.order[1]].height_space=c[c.order[2]];c[c.order[1]].length=parseFloat(c[c.order[0]].space_length);c[c.order[1]].length_space=c[c.order[0]];c[c.order[1]].width=parseFloat(c[c.order[0]].space_length);c[c.order[1]].width_space=c[c.order[0]];c[c.order[2]].height=parseFloat(c[c.order[1]].space_length);c[c.order[2]].height_space=c[c.order[1]];c[c.order[2]].length=parseFloat(c[c.order[0]].space_length);c[c.order[2]].length_space=c[c.order[0]];c[c.order[2]].width=parseFloat(c[c.order[0]].space_length);c[c.order[2]].width_space=c[c.order[0]];c[c.order[0]].offset=parseFloat(c[c.order[1]].space_length)*parseFloat(c[c.order[2]].space_length);c[c.order[1]].offset=parseFloat(c[c.order[0]].space_length);c[c.order[2]].offset=parseFloat(c[c.order[0]].space_length);c[c.order[0]].slice_length=c[c.order[0]].height*c[c.order[0]].length},error:function(j,k){throw {request:j,textStatus:k}}})};this.load_data=function(h,j,g){var i=new XMLHttpRequest();if(h.match(/\?/)){h=h+"&"+e}else{h=h+"?"+e}i.open("GET",h,true);i.responseType="arraybuffer";i.onreadystatechange=function(){if(i.readyState==4){if(i.status==200){if(i.mozResponseArrayBuffer!=undefined){c.data=new Uint8Array(i.mozResponseArrayBuffer)}else{c.data=new Uint8Array(i.response)}c.min=0;c.max=255;j(c,g)}}};i.send(null)};this.parseData=function(k,m,g){k=k.replace(/\s+$/,"");k=k.replace(/^\s+/,"");var j=k.split(/\s+/);k="";var l=j.length;for(var h=0;h<l;h++){j[h]=parseInt(j[h])}c.min=j.min();c.max=j.max();j=new Uint16Array(j);c.data=j;m(this,g)};this.sliceFromCoordinates=function(h,g,j,i){};this.slice=function(h,g,m){if(c.order==undefined){return false}if(c.time){if(!m){m=0}var v=m*c[c.order[0]].height*c[c.order[0]].length*parseFloat(c[c.order[0]].space_length)}else{var v=0}var o=c[h].space_length;var l=c[h].step;var r=c[h].length_space.step;var y=c[h].height_space.step;if(c.order[0]==h){var q=c[h].height*c[h].length;var s=c[h].height;var p=c[h].length;var n=1;var t=p;var u=q;var w=new Uint16Array(q);if(r>0){if(y>0){for(var A=0;A<q;A++){w[A]=this.data[v+u*g+A]}}else{for(var A=s;A>0;A--){for(var z=0;z<p;z++){w[(s-A)*p+z]=this.data[v+u*g+A*p+z]}}}}else{if(y<0){for(var A=0;A<s;A++){for(var z=0;z<p;z++){w[A*p+z]=this.data[v+u*g+A*p+p-z]}}}else{for(var A=s;A>0;A--){for(var z=0;z<p;z++){w[(s-A)*p+z]=this.data[v+u*g+A*p+p-z]}}}}}else{if(c.order[1]==h){var s=c[h].height;var q=c[h].height*c[h].length;var p=c[h].length;var n=1;var t=c[c.order[0]].slice_length;var u=c[c.order[0]].length;var w=new Uint16Array(q);if(y<0){for(var z=0;z<s;z++){for(var x=0;x<p;x++){w[z*(p)+x]=c.data[v+g*u+t*x+z]}}}else{for(var z=s;z>=0;z--){for(var x=0;x<p;x++){w[(s-z)*(p)+x]=c.data[v+g*u+t*x+z]}}}}else{var s=c[h].height;var q=c[h].height*c[h].length;var p=c[h].length;var n=c[c.order[0]].slice_length;var t=c[c.order[0]].length;var u=1;var w=new Uint16Array(q);for(var z=0;z<s;z++){for(var x=0;x<p;x++){w[z*(p)+x]=c.data[v+g+c[c.order[0]].length*z+x*c[c.order[0]].slice_length]}}}}return w};this.nearestNeighboor=function(n,h,t,k,g){var p=new Uint16Array(k*g);var r=h/k;var o=t/g;for(var m=0;m<g;m++){for(var l=0;l<k;l++){var s=Math.floor(l*r);var q=Math.floor(m*o);p[Math.floor(m*k+l)]=n[Math.floor(q*h+s)]}}return p};this.getScaledSlice=function(k,m,j,p){var l=c.slice(k,m,j);var h=c[k].length;var o=c[k].height;var i=Math.ceil(Math.abs(c[k].length_space.step)*h*p);var g=Math.ceil(Math.abs(c[k].height_space.step)*o*p);var n=this.nearestNeighboor(l,h,o,i,g);if(k=="xspace"&&c.xspace.height_space.name=="yspace"){if(c.zspace.step<0){n=rotateUint16Array90Right(n,i,g)}else{n=rotateUint16Array90Left(n,i,g)}}if(k=="yspace"&&c.yspace.height_space.name=="xspace"){if(c.zspace.step<0){n=rotateUint16Array90Right(n,i,g)}else{n=rotateUint16Array90Left(n,i,g)}}if(k=="zspace"&&c.zspace.height_space.name=="xspace"){n=rotateUint16Array90Left(n,i,g)}return n};this.getValueAtLocation=function(g,j,i,h){};if(b!=null&&f!=null){this.load_headers(b);this.load_data(b,f,a)}}function ColorManager(){function c(l,d,p,h,n,k,m,g,f){var l=l.colors;var o=((n-h)+(n-h)/l.length)/l.length;for(var j=0;j<p.length;j++){if(p[j]<=h){var q=0}else{if(p[j]>n){var q=l.length-1}else{var q=parseInt((p[j]-h)/o)}}if(k){var e=255}else{var e=1}d[j*4+0]=e*l[q][0]*g+m*e;d[j*4+1]=e*l[q][1]*g+m*e;d[j*4+2]=e*l[q][2]*g+m*e;if(f){d[j*4+3]=e*f}else{d[j*4+3]=e}}return d}this.createColorMap=c;function a(k){var d=k[0];for(var g=0;g<k[0].length/4;g++){for(var f=1;f<k.length;f++){var e=d[g*4+3];var h=k[f][g*4+3];d[g*4]=d[g*4]*e+k[f][g*4]*h;d[g*4+1]=d[g*4+1]*e+k[f][g*4+1]*h;d[g*4+2]=d[g*4+2]*e+k[f][g*4+2]*h;d[g*4+3]=e+h}}return d}this.blendColors=a;function b(e,l,j,g){var d=l.length;var k=new Array(d);var h=0;for(var f=0;f<d;f++){k[f]=c(e,new Array(l[f].values.length),l[f].values,l[f].rangeMin,l[f].rangeMax,false,0,1,l[f].alpha)}return a(k)}this.blendColorMap=b}function Spectrum(e){var c=this;var a=new ColorManager();function b(f,p,h,o){var j=document.createElement("canvas");jQuery(j).attr("width",256);jQuery(j).attr("height",h);var l=new Array(256);for(var n=0;n<256;n++){if(o){l[255-n]=n}else{l[n]=n}}f=a.createColorMap(c,[],l,0,255,true,0,1);var g=j.getContext("2d");for(var m=0;m<256;m++){g.fillStyle="rgb("+parseInt(f[m*4])+","+parseInt(f[m*4+1])+","+parseInt(f[m*4+2])+")";g.fillRect(m,0,1,p)}console.log("rgb("+parseInt(f[100*4+0])+","+parseInt(f[100*4+1])+","+parseInt(f[100*4+2]));console.log(g.fillStyle);return j}c.createSpectrumCanvas=function(f){if(f==null){f=c.colors}var g=b(f,20,20,false);return g};c.createSpectrumCanvasWithScale=function(j,f,g,k){if(g==null){g=c.colors}var h=b(g,20,40,k);var i=h.getContext("2d");i.fillStyle="#FFA000";i.fillRect(0.5,20,1,10);i.fillText(j.toPrecision(3),0.5,40);i.fillRect(h.width/4,20,1,10);i.fillText(((j+f)/4).toPrecision(3),h.width/4,40);i.fillRect(h.width/2,20,1,10);i.fillText(((j+f)/2).toPrecision(3),h.width/2,40);i.fillRect(3*(h.width/4),20,1,10);i.fillText((3*((j+f)/4)).toPrecision(3),3*(h.width/4),40);i.fillRect(h.width-0.5,20,1,10);i.fillText(f.toPrecision(3),h.width-20,40);return h};function d(m){m=m.replace(/\s+$/,"");m=m.replace(/^\s+/,"");var j=m.split(/\n/);var f=new Array();for(var h=0;h<j.length;h++){var l=j[h].replace(/\s+$/,"").split(/\s+/);for(var g=0;g<l.length;g++){l[g]=parseFloat(l[g])}if(l.length<4){l.push(1)}f.push(l)}c.colors=f;return f}if(e!=undefined){d(e)}}function Loader(){var c=this;function a(d,e,f){jQuery.ajax({type:"GET",url:d,dataType:"text",success:function(g){f(g)},error:function(g,i,h){},data:{},async:e,timeout:100000})}function b(g,f){var d=new FileReader();var e=g.files;d.file=e[0];d.onloadend=function(h){f(h.target.result)};d.readAsText(e[0])}c.loadObjFromUrl=function(d){a(d,false,function(e){c.createBrain(new MNIObject(e))})};c.loadObjFromFile=function(d){b(d,function(e){c.createBrain(new MNIObject(e))})};c.loadSpectrumFromUrl=function(e){var d=[];a(e,false,function(f){d=new Spectrum(f);if(c.afterLoadSpectrum!=null){c.afterLoadSpectrum(d)}});return d};c.loadSpectrumFromFile=function(d){b(d,function(f){var e=new Spectrum(f);c.spectrum=e;if(c.afterLoadSpectrum!=null){c.afterLoadSpectrum(e)}if(c.data){c.updateColors(c.data,c.rangeMin,c.rangeMax,c.spectrum)}})}}function BrainCanvas(b){if(!b){b={}}var j=this;var h=new ColorManager(),c=b.xcanvas||document.createElement("canvas"),n=b.ycanvas||document.createElement("canvas"),e=b.zcanvas||document.createElement("canvas"),g=c.getContext("2d"),f=n.getContext("2d"),d=e.getContext("2d");c.zoom=1;n.zoom=1;e.zoom=1;c.translate_origin={x:0,y:0};n.translate_origin={x:0,y:0};e.translate_origin={x:0,y:0};c.translate_vector={x:0,y:0};n.translate_vector={x:0,y:0};e.translate_vector={x:0,y:0};var m=new Loader();j.slices={};j.brightness=0;j.contrast=1;var i={spectral:m.loadSpectrumFromUrl("/spectrum/spectral-brainview.txt"),grayscale:m.loadSpectrumFromUrl("/spectrum/gray_scale256.txt")};var k=i.spectral;j.spectrums=i;this.initCanvas=function(p,r,o){p.width=r;p.height=o;var q=p.getContext("2d");q.fillStyle="#000000";q.fillRect(0,0,r,o)};this.update_space=function(s,q,p,t,w,r){j.slices[s]=t;j.slices[s].space_height=Math.ceil(Math.abs(w[s].height_space.step)*w[s].height_space.space_length*q.zoom);var o=Math.ceil(Math.abs(w[s].length_space.step)*w[s].length_space.space_length*q.zoom);var x=Math.ceil(Math.abs(w[s].height_space.step)*w[s].height_space.space_length*q.zoom);q.current_image={width:o,height:x};if(s=="xspace"&&w.xspace.height_space.name=="yspace"){q.current_image.width=x;q.current_image.height=o}if(s=="yspace"&&w.yspace.height_space.name=="xspace"){q.current_image.width=x;q.current_image.height=o}if(s=="zspace"&&w.zspace.height_space.name=="xspace"){q.current_image.width=x;q.current_image.height=widht}var u=p.createImageData(q.current_image.width,q.current_image.height);var v=w.getScaledSlice(s,t,r,q.zoom);u.data=h.createColorMap(k,u.data,v,w.min,w.max,true,j.brightness,j.contrast);p.putImageData(u,q.translate_vector.x,q.translate_vector.y)};function a(p,o,q){p.fillStyle="#FF0000";p.fillRect(o-2,q-2,4,4)}this.updateXSpace=function(p,o,q){j.update_space("xspace",c,g,p,o,q)};this.updateYSpace=function(p,o,q){j.update_space("yspace",n,f,p,o,q)};this.updateZSpace=function(p,o,q){j.update_space("zspace",e,d,p,o,q)};this.showCrosshairs=function(){if(j.current_minc.xspace.step<0){var t=(j.current_minc.xspace.space_length-j.slices.xspace)*Math.abs(j.current_minc.yspace.step);var s=t}else{var t=j.slices.xspace*Math.abs(j.current_minc.yspace.step);var s=t}if(j.current_minc.yspace.step>0){var o=(j.current_minc.yspace.space_length-j.slices.yspace)*Math.abs(j.current_minc.yspace.step);var r=j.slices.yspace*Math.abs(j.current_minc.yspace.step)}else{var o=j.slices.yspace*Math.abs(j.current_minc.yspace.step);var r=(j.current_minc.yspace.space_length-j.slices.yspace)*Math.abs(j.current_minc.yspace.step)}if(j.current_minc.zspace.step>0){var p=(j.current_minc.zspace.space_length-j.slices.zspace)*Math.abs(j.current_minc.zspace.step);var q=p}else{var p=j.slices.zspace*Math.abs(j.current_minc.zspace.step);var q=p}a(g,r*c.zoom+c.translate_vector.x,p*c.zoom+c.translate_vector.y);a(f,s*n.zoom+n.translate_vector.x,p*n.zoom+n.translate_vector.y);a(d,s*e.zoom+e.translate_vector.x,o*e.zoom+e.translate_vector.y)};j.showCoordinates=function(){$('<div id="coordinates">x:<span id="x"></span> y:<span id="y"></span> z:<span id="z"></span></div>').appendTo($(c).parent())};j.updateCoordinates=function(o){$(c).siblings("#coordinates").children("#x").html(o.x);$(c).siblings("#coordinates").children("#y").html(o.y);$(c).siblings("#coordinates").children("#z").html(o.z)};this.updateSlices=function(p,q){j.current_time=q;if(p){var o=j.getSliceNumbersFromPosition(l(p))}else{var o={x:j.slices.xspace,y:j.slices.yspace,z:j.slices.zspace}}j.initCanvas(c,c.width,c.height);j.initCanvas(n,n.width,n.height);j.initCanvas(e,e.width,e.height);j.updateXSpace(o.x,j.current_minc,q);j.updateYSpace(o.y,j.current_minc,q);j.updateZSpace(o.z,j.current_minc,q);j.showCrosshairs();j.updateCoordinates(j.sliceToWorldCoordinates(o))};this.zoomIn=function(p,o,q){if(o.zoom==undefined){o.zoom=1*1.01}else{o.zoom=o.zoom*1.1}j.updateSlices(null,j.current_time)};this.zoomOut=function(p,o,q){if(o.zoom==undefined){o.zoom=0.9}else{o.zoom=o.zoom*0.9}j.updateSlices(null,j.current_time)};this.translate=function(p,o){var q=l(p);if(o.translate_origin){o.translate_vector={x:(o.translate_origin.x-q.x2),y:(o.translate_origin.y-q.y)};j.updateSlices(null,j.current_time)}};this.showMinc=function(o){$(c).siblings("#mincinfo").append("Minc Information: <br>order: "+o.order+"<br>xspace.height: "+o.xspace.height+" yspace.height: "+o.yspace.height+" zspace.height: "+o.zspace.height+"<br> xspace.length: "+o.xspace.length+" yspace.length: "+o.yspace.length+" zspace.length: "+o.zspace.length+"xspace step: "+o.xspace.step+"yspace step: "+o.yspace.step+"zspace step: "+o.zspace.step);j.slices.xspace=parseInt(o.xspace.length/2);j.slices.yspace=parseInt(o.yspace.length/2);j.slices.zspace=parseInt(o.zspace.length/2);j.updateXSpace(j.slices.xspace,o);j.updateYSpace(j.slices.yspace,o);j.updateZSpace(j.slices.zspace,o);j.showCrosshairs();j.updateCoordinates(o.xspace.length/2,o.yspace.length/2,o.zspace.length/2)};function l(p){var o;var q;if(p.pageX!=undefined&&p.pageY!=undefined){o=p.pageX;q=p.pageY}else{o=p.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;q=p.clientY+document.body.scrollTop+document.documentElement.scrollTop}o-=p.target.offsetLeft;q-=p.target.offsetTop;q=p.target.height-q;return{target:p.target,x:o,y:q,x2:p.target.width-o}}this.sliceToWorldCoordinates=function(u){var s=j.current_minc.xspace.start;var p=j.current_minc.xspace.step;var r=j.current_minc.yspace.start;var t=j.current_minc.yspace.step;var o=j.current_minc.zspace.start;var q=j.current_minc.zspace.step;return{x:s+u.x*p,y:r+u.y*t,z:o+u.z*q}};this.getSliceNumbersFromPosition=function(o){j.position=o;if(o.target.id==c.id){var p={x:j.slices.xspace,y:parseInt((o.x-c.translate_vector.x)/Math.abs(j.current_minc.xspace.height_space.step)/c.zoom),z:parseInt((o.y+c.translate_vector.y-(c.height-c.current_image.height))/Math.abs(j.current_minc.xspace.length_space.step)/c.zoom)};if(j.current_minc.yspace.step<0){p.y=j.current_minc.yspace.space_length-p.y}if(j.current_minc.zspace.step<0){p.z=j.current_minc.zspace.space_length-p.z}}else{if(o.target.id==n.id){var p={y:j.slices.yspace,x:parseInt((o.x-n.translate_vector.x)/(Math.abs(j.current_minc.xspace.step)*n.zoom)),z:parseInt((o.y+n.translate_vector.y-(n.height-n.current_image.height))/(Math.abs(j.current_minc.zspace.step)*n.zoom))};if(j.current_minc.xspace.step<0){p.x=j.current_minc.xspace.space_length-p.x}if(j.current_minc.zspace.step<0){p.z=j.current_minc.zspace.space_length-p.z}}else{var p={z:j.slices.zspace,x:parseInt((o.x-e.translate_vector.x)/(Math.abs(j.current_minc.zspace.length_space.step)*e.zoom)),y:parseInt((o.y+e.translate_vector.y-(e.height-e.current_image.height))/(Math.abs(j.current_minc.yspace.step)*e.zoom))};if(j.current_minc.xspace.step<0){p.x=j.current_minc.xspace.space_length-p.x}if(j.current_minc.yspace.step<0){p.y=j.current_minc.yspace.space_length-p.y}}}return p};this.addListeners=function(o){o.onmousedown=function(q){j.drag=true;if(q.shiftKey){var p=l(q);o.translate_origin={x:o.translate_vector.x+p.x2,y:o.translate_vector.y+p.y}}return false};o.onmouseup=function(p){j.drag=false};o.onmousemove=function(p){if(j.drag){if(p.shiftKey){j.translate(p,o)}else{j.updateSlices(p)}}};jQuery(o).mousewheel(function(p,q){if(q>0){j.zoomIn(p,o,q)}else{j.zoomOut(p,o,q)}return false})};this.showTime=function(){$('<div id="time">Time Index: </div>').appendTo($(c).parent());var o={playing:false,position:0};var t=$($(c).parent().children("#time"));$('<span id="time-value">1</span>').appendTo(t);$('<div id="time-slider" width="'+c.width+'" + height="10"></div>').slider({value:0,min:0,max:j.current_minc.time.space_length,step:1,change:function(u,v){console.log("BLAH!");j.updateSlices(null,v.value);o.position=v.value;$(t).children("#time-value").html(v.value)},slide:function(u,v){console.log("BLAH!");j.updateSlices(null,v.value);o.position=v.value;$(t).children("#time-value").html(v.value)}}).appendTo(t);$('<div class="toolbar"><span id="time-toolbar" class="ui-widget-header ui-corner-all"><button id="play">play</button><button id="stop">stop</button></span></div>').appendTo(t);function q(){if(o.playing){o.position+=1;if(o.position>j.current_minc.time.space_length){o.position=0}$(t).children("#time-slider").slider("value",o.position);setTimeout(q,500)}}function s(){o.playing=true;q()}function r(){o.playing=false}function p(){o.playing=false;o.position=0;$(t).children("#time-slider").slider("value",o.position)}$("#time-toolbar").children("#play").button({label:"play",text:false,icons:{primary:"ui-icon-play"}}).click(function(){var u;if($(this).text()==="play"){u={label:"pause",icons:{primary:"ui-icon-pause"}};s()}else{u={label:"play",icons:{primary:"ui-icon-play"}};r()}$(this).button("option",u)});$("#time-toolbar").children("#stop").button({label:"stop",text:false,icons:{primary:"ui-icon-stop"}}).click(function(){$("#play").button("option",{label:"play",icons:{primary:"ui-icon-play"}});p()})};this.showBrightness=function(){$('<div id="brightness">Brightness: </div>').appendTo($(c).parent());var o=$($(c).parent().children("#brightness"));$('<span id="brightness-value">0%</span>').appendTo(o);$('<div id="brightness-slider" width="100px" + height="10"></div>').slider({value:0,min:-1,max:1,step:0.1,slide:function(p,q){j.brightness=q.value;j.updateSlices(null,j.current_time);$(o).children("#brightness-value").html(q.value*100+"%")}}).appendTo(o)};this.showContrast=function(){$('<div id="contrast">Contrast: </div>').appendTo($(c).parent());var o=$($(c).parent().children("#contrast"));$('<span id="contrast-value">1</span>').appendTo(o);$('<div id="contrast-slider" width="100px" + height="10"></div>').slider({value:1,min:1,max:5,step:0.1,slide:function(p,q){j.contrast=q.value;j.updateSlices(null,j.current_time);$(o).children("#contrast-value").html(q.value)}}).appendTo(o)};this.changeSpectrum=function(o){k=i[o];j.updateSlices(null,j.time)};this.showSpectrum=function(){$('<div id="spectrum">Color Scale</div>').appendTo($(c).parent());var o=$($(c).parent().children("#spectrum"));$('<select id="spectrum-select"><option value="spectral">Spectral</option><option value="grayscale">Gray Scale</option></select>').appendTo(o);$(o).children("#spectrum-select").change(function(p){j.changeSpectrum($(p.target).val())})};this.openFile=function(o){this.current_minc=new Minc(o,b,function(q,r){var p=b.canvasHeight||256,s=b.canvasWidth||256;j.initCanvas(c,s,p);j.initCanvas(n,s,p);j.initCanvas(e,s,p);j.showCoordinates();j.showMinc(q);if(q.time){j.showTime()}j.showBrightness();j.showContrast();j.showSpectrum();j.addListeners(c);j.addListeners(n);j.addListeners(e)})}};