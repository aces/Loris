language: php

cache:
    directories:
        - vendor

php:
    - 5.4
#   - 5.6
#   - '7'

sudo: false

before_install:
    - if [ "$TRAVIS_BRANCH" == "master" ]; then
        echo "Do not send pull requests to the master branch, send them to VERSION-dev branches" && exit 1;
      fi
    - pip install --user codecov
    # Start Xvfb in a desktop screen size,
    # otherwise some tests will fail because the links
    # are hidden when Selenium tries to find them.
    - "/sbin/start-stop-daemon --start --quiet --pidfile /tmp/custom_xvfb_99.pid --make-pidfile --background --exec /usr/bin/Xvfb -- :99 -ac -screen 0 1600x1200x16"
    #- "export DISPLAY=:99.0"
    #- "sh -e /etc/init.d/xvfb start"

install:
    # Install composer modules
    - composer install --dev
    - phpenv rehash

    # Install jslint
    - npm install -g jslint

      # Download a Selenium Web Driver release
    - wget "http://selenium-release.storage.googleapis.com/2.45/selenium-server-standalone-2.45.0.jar"

    - php -S localhost:8000 -t htdocs 2>1 > /dev/null &

    # Start Selenium and redirect Selenium WebDriver
    # output to /dev/null so that it doesn't flood the
    # screen in the middle of our other tests
    - DISPLAY=:99.0 java -jar selenium-server-standalone-2.45.0.jar  2>1 > /dev/null &

script:
    # Run unit tests to make sure functions still do what they should.
    - vendor/bin/phpunit --configuration test/phpunit.xml --testsuite 'LorisUnitTests for php/libraries' --coverage-clover=coverage.xml


after_success:
    - bash <(curl -s https://codecov.io/bash)
