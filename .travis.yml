language: php

cache:
    directories:
        - vendor

php:
    - "7"
    - "7.1"

sudo: false

addons:
    firefox: "44.0"

before_install:
    # Start Xvfb in a desktop screen size,
    # otherwise some tests will fail because the links
    # are hidden when Selenium tries to find them.
    - "/sbin/start-stop-daemon --start --quiet --pidfile /tmp/custom_xvfb_99.pid --make-pidfile --background --exec /usr/bin/Xvfb -- :99 -ac -screen 0 1600x1200x16"
    #- "export DISPLAY=:99.0"
    #- "sh -e /etc/init.d/xvfb start"
    # Ensure node version is up to date
    - nvm install node
    - mkdir -p project project/libraries
    - phpenv config-rm xdebug.ini

install:
    - curl -L https://github.com/docker/compose/releases/download/1.8.1/docker-compose-`uname -s`-`uname -m` > ~/docker-compose
    - chmod +x ~/docker-compose
    - sudo mv ~/docker-compose /usr/local/bin/docker-compose
    # Install composer modules
    - composer install
    - phpenv rehash

    # Install node modules specified in package.json
    - npm install
    - docker-compose build
    - docker-compose start

before_script:
    # Set up the Loris environment
#env:
 # - "LORIS_DB_CONFIG=test/config.xml"


script:
    - npm run lint:php
    - npm run tests:integration

    # Run unit tests to make sure functions still do what they should.

dist: precise
