!function(e){function t(s){if(a[s])return a[s].exports;var i=a[s]={exports:{},id:s,loaded:!1};return e[s].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=React.createClass({displayName:"CollapsibleComment",getInitialState:function(){return{collapsed:!0}},toggleCollapsed:function(){this.setState({collapsed:!this.state.collapsed})},render:function(){var e=[],t=this.state.collapsed?"Show Comment History":"Hide Comment History",a=this.props.commentHistory;for(var s in a)if(a.hasOwnProperty(s)){var i=" updated the "+a[s].fieldChanged+" to ";"comment"===a[s].fieldChanged&&(i=" commented "),e.push(React.createElement("div",{key:"comment_"+s},"[",a[s].dateAdded,"]",React.createElement("b",null," ",a[s].addedBy),i,React.createElement("i",null," ",a[s].newValue)))}return React.createElement("div",{className:"row form-group"},React.createElement("div",{className:"col-sm-9"},React.createElement("div",{className:"btn btn-primary",onClick:this.toggleCollapsed,"data-toggle":"collapse","data-target":"#comment-history",style:{margin:"10px 0"}},t)),React.createElement("div",{className:"col-sm-9"},React.createElement("div",{id:"comment-history",className:"collapse"},e)))}}),s=React.createClass({displayName:"IssueEditForm",propTypes:{DataURL:React.PropTypes.string.isRequired,action:React.PropTypes.string.isRequired},getInitialState:function(){return{Data:[],formData:{},submissionResult:null,errorMessage:null,isLoaded:!1,loadedData:0,isNewIssue:!1,issueID:0}},componentDidMount:function(){this.getDataAndChangeState()},render:function(){if(!this.state.isLoaded)return void 0!==this.state.error?React.createElement("div",{className:"alert alert-danger text-center"},React.createElement("strong",null,this.state.error)):React.createElement("button",{className:"btn-info has-spinner"},"loading",React.createElement("span",{className:"glyphicon glyphicon-refresh glyphicon-refresh-animate"}));var e="",t="alert text-center hide",s=this.state.Data.hasEditPermission||this.state.Data.isOwnIssue||this.state.isNewIssue,i=" ";i=this.state.isNewIssue?"Create New Issue":"Edit Issue #"+this.state.issueData.issueID;var r=" ";r=this.state.isNewIssue?"Never!":this.state.issueData.lastUpdate;var n=" ";n=this.state.isNewIssue?"No-one!":this.state.issueData.lastUpdatedBy;var l=" ";l=this.state.isNewIssue?"Sometime Soon!":this.state.issueData.dateCreated;var o=this.state.issueData.watching,c="";c=this.state.isNewIssue?"Submit Issue":"Update Issue";var m="";m=this.state.isNewIssue?"Description":"New Comment";var u=this.state.isNewIssue||React.createElement(a,{commentHistory:this.state.issueData.commentHistory});if(this.state.submissionResult)if("success"===this.state.submissionResult)t="alert alert-success text-center",e="Submission Successful!";else if("error"===this.state.submissionResult){var d=this.state.errorMessage;t="alert alert-danger text-center",e=d?d:"Failed to submit issue :("}else if("invalid"===this.state.submissionResult){var h=this.state.errorMessage;t="alert alert-danger text-center",e=h?h:"Invalid input"}var p,f;return this.state.isNewIssue||(p=React.createElement("div",null,React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-6"},React.createElement(StaticElement,{name:"lastUpdate",label:"Last Update: ",ref:"lastUpdate",text:r})),React.createElement("div",{className:"col-md-6"},React.createElement(StaticElement,{name:"lastUpdatedBy",label:"Last Updated By: ",ref:"lastUpdatedBy",text:n}))),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-6"},React.createElement(StaticElement,{name:"dateCreated",label:"Date Created: ",ref:"dateCreated",text:l})),React.createElement("div",{className:"col-md-6"},React.createElement(StaticElement,{name:"reporter",label:"Reporter: ",ref:"reporter",text:this.state.issueData.reporter})))),f=React.createElement(StaticElement,{name:"description",label:"Description",ref:"description",text:this.state.issueData.desc})),React.createElement("div",null,React.createElement(FormElement,{name:"issueEdit",onSubmit:this.handleSubmit,ref:"form"},React.createElement("h3",null,i),React.createElement("br",null),p,React.createElement("br",null),React.createElement("br",null),React.createElement(TextboxElement,{name:"title",label:"Title",onUserInput:this.setFormData,ref:"title",value:this.state.formData.title,disabled:!s,required:!0}),f,React.createElement(SelectElement,{name:"assignee",label:"Assignee",emptyOption:!0,options:this.state.Data.assignees,onUserInput:this.setFormData,ref:"assignee",disabled:!s,value:this.state.formData.assignee,required:!0}),React.createElement(SelectElement,{name:"centerID",label:"Site",emptyOption:!0,options:this.state.Data.sites,onUserInput:this.setFormData,ref:"centerID",disabled:!s,value:this.state.formData.centerID}),React.createElement(SelectElement,{name:"status",label:"Status",emptyOption:!1,options:this.state.Data.statuses,onUserInput:this.setFormData,ref:"status",disabled:!s,value:this.state.formData.status}),React.createElement(SelectElement,{name:"priority",label:"Priority",emptyOption:!1,options:this.state.Data.priorities,onUserInput:this.setFormData,ref:"priority",required:!1,disabled:!s,value:this.state.formData.priority}),React.createElement(SelectElement,{name:"category",label:"Category",emptyOption:!0,options:this.state.Data.categories,onUserInput:this.setFormData,ref:"category",disabled:!s,value:this.state.formData.category}),React.createElement(SelectElement,{name:"module",label:"Module",emptyOption:!0,options:this.state.Data.modules,onUserInput:this.setFormData,ref:"module",disabled:!s,value:this.state.formData.module}),React.createElement(TextboxElement,{name:"PSCID",label:"PSCID",onUserInput:this.setFormData,ref:"PSCID",disabled:!s,value:this.state.formData.PSCID}),React.createElement(TextboxElement,{name:"visitLabel",label:"Visit Label",onUserInput:this.setFormData,ref:"visitLabel",disabled:!s,value:this.state.formData.visitLabel}),React.createElement(SelectElement,{name:"watching",label:"Watching?",emptyOption:!1,options:{No:"No",Yes:"Yes"},onUserInput:this.setFormData,ref:"watching",value:o}),React.createElement(SelectElement,{name:"othersWatching",label:"Add others to watching?",emptyOption:!0,options:this.state.Data.otherWatchers,onUserInput:this.setFormData,ref:"watching",multiple:!0,value:this.state.formData.whoIsWatching}),React.createElement(TextareaElement,{name:"comment",label:m,onUserInput:this.setFormData,ref:"comment",value:this.state.formData.comment}),React.createElement("div",{className:t,role:"alert",ref:"alert-message"},e),React.createElement(ButtonElement,{label:c})),u)},getDataAndChangeState:function(){var e=this.props.DataURL;$.ajax(e,{dataType:"json",success:function(e){this.setState({Data:e,isLoaded:!0,issueData:e.issueData,formData:e.issueData,error:"finished success",isNewIssue:!e.issueData.issueID})}.bind(this),error:function(e,t,a){this.setState({error:a})}.bind(this)})},handleSubmit:function(e){if(e.preventDefault(),"pending"!==this.state.submissionResult){this.setState({submissionResult:"pending"});var t=this.state.formData,a=this.refs,s=new FormData;if(this.isValidForm(a,t)){for(var i in t)""!==t[i]&&s.append(i,t[i]);$.ajax({type:"POST",url:this.props.action,data:s,cache:!1,dataType:"json",contentType:!1,processData:!1,xhr:function e(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=$("#progressbar"),a=$("#progresslabel"),s=Math.round(e.loaded/e.total*100);$(t).width(s+"%"),$(a).html(s+"%"),t.attr("aria-valuenow",s)}},!1),e},success:function(e){return e.isValidSubmission?(this.setState({submissionResult:"success",issueID:e.issueID}),this.showAlertMessage(),void(this.state.isNewIssue&&setTimeout(function(){window.location.assign("/issue_tracker")},2e3))):(this.setState({errorMessage:e.invalidMessage,submissionResult:"invalid"}),void this.showAlertMessage())}.bind(this),error:function(e){console.error(e),this.setState({submissionResult:"error"}),this.showAlertMessage()}.bind(this)})}}},setFormData:function(e,t){var a=this.state.formData;a[e]=t,this.setState({formData:a})},isValidForm:function e(t,a){var e=!0,s={title:null,assignee:null};return Object.keys(s).map(function(i){a[i]?s[i]=a[i]:t[i]&&(t[i].props.hasError=!0,e=!1)}),this.forceUpdate(),e},showAlertMessage:function(){var e=this;if(null!==this.refs["alert-message"]){var t=this.refs["alert-message"];$(t).fadeTo(2e3,500).delay(5e3).slideUp(500,function(){e.setState({uploadResult:null})})}}}),i=React.createFactory(s);window.IssueEditForm=s,window.RIssueEditForm=i,t.default=s}]);
//# sourceMappingURL=editIssue.js.map