!function(e){function t(s){if(a[s])return a[s].exports;var r=a[s]={exports:{},id:s,loaded:!1};return e[s].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=React.createClass({displayName:"CollapsibleComment",getInitialState:function(){return{collapsed:!0}},toggleCollapsed:function(){this.setState({collapsed:!this.state.collapsed})},render:function(){var e=[],t=this.state.collapsed?"Show Comment History":"Hide Comment History",a=this.props.commentHistory;for(var s in a)"comment"===a[s].fieldChanged?e.push("  ["+a[s].dateAdded+"] ",React.createElement("b",null," ",a[s].addedBy," ")," commented",React.createElement("i",null," ",a[s].newValue," "),React.createElement("br",null)):e.push("  ["+a[s].dateAdded+"] ",React.createElement("b",null," ",a[s].addedBy," ")," updated the "+a[s].fieldChanged+" to",React.createElement("i",null," ",a[s].newValue," "),React.createElement("br",null));return React.createElement("div",{className:"row form-group"},React.createElement("div",{className:"col-sm-9"},React.createElement("div",{className:"btn btn-primary",onClick:this.toggleCollapsed,"data-toggle":"collapse","data-target":"#comment-history",style:{margin:"10px 0"}},t)),React.createElement("div",{className:"col-sm-9"},React.createElement("div",{id:"comment-history",className:"collapse"},e)))}}),s=React.createClass({displayName:"IssueEditForm",propTypes:{DataURL:React.PropTypes.string.isRequired,action:React.PropTypes.string.isRequired},getInitialState:function(){return{Data:[],formData:{},submissionResult:null,errorMessage:null,isLoaded:!1,loadedData:0,isNewIssue:!1,issueID:0}},componentDidMount:function(){this.getDataAndChangeState()},render:function(){if(!this.state.isLoaded)return void 0!==this.state.error?React.createElement("div",{className:"alert alert-danger text-center"},React.createElement("strong",null,this.state.error)):React.createElement("button",{className:"btn-info has-spinner"},"loading",React.createElement("span",{className:"glyphicon glyphicon-refresh glyphicon-refresh-animate"}));var e="",t="alert text-center hide",s=this.state.Data.hasEditPermission||this.state.Data.isOwnIssue||this.state.isNewIssue,r=" ";r=this.state.isNewIssue?"Create New Issue":"Edit Issue #"+this.state.formData.issueID;var i=" ";i=this.state.isNewIssue?"Never!":this.state.formData.lastUpdate;var l=" ";l=this.state.isNewIssue?"No-one!":this.state.formData.lastUpdatedBy;var n=" ";n=this.state.isNewIssue?"Sometime Soon!":this.state.formData.dateCreated;var o=this.state.formData.watching,c="";c=this.state.isNewIssue?"Submit Issue":"Update Issue";var m="";m=this.state.isNewIssue?"Description":"New Comment";var d;if(d=this.state.isNewIssue?React.createElement("div",{class:"form-group"},"Â "):React.createElement(a,{commentHistory:this.state.formData.commentHistory}),this.state.submissionResult)if("success"===this.state.submissionResult)t="alert alert-success text-center",e="Submission Successful!";else if("error"===this.state.submissionResult){var u=this.state.errorMessage;t="alert alert-danger text-center",e=u?u:"Failed to submit issue :("}else if("invalid"===this.state.submissionResult){var h=this.state.errorMessage;t="alert alert-danger text-center",e=h?h:"Invalid input"}var p,f;return this.state.isNewIssue||(p=React.createElement("div",null,React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-6"},React.createElement(StaticElement,{name:"lastUpdate",label:"Last Update: ",ref:"lastUpdate",text:i})),React.createElement("div",{className:"col-md-6"},React.createElement(StaticElement,{name:"lastUpdatedBy",label:"Last Updated By: ",ref:"lastUpdatedBy",text:l}))),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-6"},React.createElement(StaticElement,{name:"dateCreated",label:"Date Created: ",ref:"dateCreated",text:n})),React.createElement("div",{className:"col-md-6"},React.createElement(StaticElement,{name:"reporter",label:"Reporter: ",ref:"reporter",text:this.state.formData.reporter})))),f=React.createElement("div",null,React.createElement("div",{class:"row"},React.createElement(StaticElement,{name:"description",label:"Description",ref:"description",text:"null"===this.state.formData.desc?"":this.state.formData.desc})))),React.createElement("div",null,React.createElement(FormElement,{name:"issueEdit",onSubmit:this.handleSubmit,ref:"form",class:""},React.createElement("h3",null,r),React.createElement("br",null),p,React.createElement("br",null),React.createElement("br",null),React.createElement("div",{class:"row"},React.createElement("div",{class:"col-sm-6"},React.createElement("div",{class:"row"},React.createElement(TextboxElement,{name:"title",label:"Title",onUserInput:this.setFormData,ref:"title",value:this.state.formData.title,disabled:!s,required:!0})),f,React.createElement("div",{class:"row"},React.createElement(SelectElement,{name:"assignee",label:"Assignee",emptyOption:!0,options:this.state.Data.assignees,onUserInput:this.setFormData,ref:"assignee",disabled:!s,value:this.state.formData.assignee,required:!0})),React.createElement("div",{class:"row"},React.createElement(SelectElement,{name:"centerID",label:"Site",emptyOption:!0,options:this.state.Data.sites,onUserInput:this.setFormData,ref:"centerID",disabled:!s,value:this.state.formData.centerID})),React.createElement("div",{class:"row"},React.createElement(SelectElement,{name:"status",label:"Status",emptyOption:!1,options:this.state.Data.statuses,onUserInput:this.setFormData,ref:"status",disabled:!s,value:this.state.formData.status})),React.createElement("div",{class:"row"},React.createElement(SelectElement,{name:"priority",label:"Priority",emptyOption:!1,options:this.state.Data.priorities,onUserInput:this.setFormData,ref:"priority",required:!1,disabled:!s,value:this.state.formData.priority})),React.createElement("div",{class:"row"},React.createElement(SelectElement,{name:"category",label:"Category",emptyOption:!0,options:this.state.Data.categories,onUserInput:this.setFormData,ref:"category",disabled:!s,value:this.state.formData.category})),React.createElement("div",{class:"row"},React.createElement(SelectElement,{name:"module",label:"Module",emptyOption:!0,options:this.state.Data.modules,onUserInput:this.setFormData,ref:"module",disabled:!s,value:this.state.formData.module})),React.createElement("div",{class:"row"},React.createElement(TextboxElement,{name:"PSCID",label:"PSCID",onUserInput:this.setFormData,ref:"PSCID",disabled:!s,value:this.state.formData.PSCID})),React.createElement("div",{class:"row"},React.createElement(TextboxElement,{name:"visitLabel",label:"Visit Label",onUserInput:this.setFormData,ref:"visitLabel",disabled:!s,value:this.state.formData.visitLabel})),React.createElement("div",{class:"row"},React.createElement(SelectElement,{name:"watching",label:"Watching?",emptyOption:!1,options:{No:"No",Yes:"Yes"},onUserInput:this.setFormData,ref:"watching",value:o})),React.createElement("div",{class:"row"},React.createElement(SelectElement,{name:"othersWatching",label:"Add others to watching?",emptyOption:!0,options:this.state.Data.otherWatchers,onUserInput:this.setFormData,ref:"watching",multiple:!0,value:this.state.formData.whoIsWatching})),React.createElement("div",{class:"row"},React.createElement(TextareaElement,{name:"comment",label:m,onUserInput:this.setFormData,ref:"comment",value:null})),React.createElement("div",{class:"row submit-area"},React.createElement(ButtonElement,{label:c}),React.createElement("div",{class:"col-md-3"},React.createElement("div",{className:t,role:"alert",ref:"alert-message"},e)))),React.createElement("div",{class:"col-sm-6"},React.createElement("div",{class:"row"},d)))))},getDataAndChangeState:function(){var e=this,t=this.props.DataURL;$.ajax(t,{dataType:"json",xhr:function t(){var t=new window.XMLHttpRequest;return t.addEventListener("progress",function(t){e.setState({loadedData:t.loaded})}),t},success:function(t){t.issueData.issueID||e.setState({isNewIssue:!0}),e.setState({Data:t,isLoaded:!0,issueData:t.issueData,formData:t.issueData}),e.setState({error:"finished success"})},error:function(t,a,s){e.setState({error:s})}})},handleSubmit:function(e){if(e.preventDefault(),"pending"!==this.state.submissionResult){this.setState({submissionResult:"pending"});var t=this.state.formData,a=this.refs,s=new FormData;if(this.isValidForm(a,t)){for(var r in t)""!==t[r]&&s.append(r,t[r]);$.ajax({type:"POST",url:this.props.action,data:s,cache:!1,dataType:"json",contentType:!1,processData:!1,xhr:function e(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=$("#progressbar"),a=$("#progresslabel"),s=Math.round(e.loaded/e.total*100);$(t).width(s+"%"),$(a).html(s+"%"),t.attr("aria-valuenow",s)}},!1),e},success:function(e){return e.isValidSubmission?(this.setState({submissionResult:"success",issueID:e.issueID}),this.showAlertMessage(),void(this.state.isNewIssue&&setTimeout(function(){window.location.assign("/issue_tracker")},2e3))):(this.setState({errorMessage:e.invalidMessage,submissionResult:"invalid"}),void this.showAlertMessage())}.bind(this),error:function(e){console.error(e),this.setState({submissionResult:"error"}),this.showAlertMessage()}.bind(this)})}}},setFormData:function(e,t){var a=this.state.formData;a[e]=t,this.setState({formData:a})},isValidForm:function e(t,a){var e=!0,s={title:null,assignee:null};return Object.keys(s).map(function(r){a[r]?s[r]=a[r]:t[r]&&(t[r].props.hasError=!0,e=!1)}),this.forceUpdate(),e},showAlertMessage:function(){var e=this;if(null!==this.refs["alert-message"]){var t=React.findDOMNode(this.refs["alert-message"]);$(t).fadeTo(2e3,500).delay(5e3).slideUp(500,function(){e.setState({uploadResult:null})})}}}),r=React.createFactory(s);window.IssueEditForm=s,window.RIssueEditForm=r,t.default=s}]);
//# sourceMappingURL=editIssue.js.map