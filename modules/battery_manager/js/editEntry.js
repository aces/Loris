!function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:!1};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.loaded=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.p="",__webpack_require__(0)}([function(module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),BatteryManagerEditForm=function(_React$Component){function BatteryManagerEditForm(props){_classCallCheck(this,BatteryManagerEditForm);var _this=_possibleConstructorReturn(this,(BatteryManagerEditForm.__proto__||Object.getPrototypeOf(BatteryManagerEditForm)).call(this,props));return _this.state={Data:{},formData:{},isLoaded:!1,loadedData:0},_this.setFormData=_this.setFormData.bind(_this),_this.handleEdit=_this.handleEdit.bind(_this),_this.isDuplicate=_this.isDuplicate.bind(_this),_this.giveOptions=_this.giveOptions.bind(_this),_this.activateEntry=_this.activateEntry.bind(_this),_this.deactivateEntry=_this.deactivateEntry.bind(_this),_this.addEntry=_this.addEntry.bind(_this),_this}return _inherits(BatteryManagerEditForm,_React$Component),_createClass(BatteryManagerEditForm,[{key:"componentDidMount",value:function(){var self=this;$.ajax(this.props.DataURL,{dataType:"json",success:function(data){var formData={id:data.batteryData.ID,instrument:data.batteryData.Test_name,ageMinDays:data.batteryData.AgeMinDays,ageMaxDays:data.batteryData.AgeMaxDays,stage:data.batteryData.Stage,subproject:data.batteryData.SubprojectID,visitLabel:data.batteryData.Visit_label,forSite:data.batteryData.CenterID,firstVisit:data.batteryData.firstVisit,instrumentOrder:data.batteryData.instr_order};self.setState({Data:data,isLoaded:!0,batteryData:data.batteryData,formData:formData})},error:function(_error,errorCode,errorMsg){console.error(_error,errorCode,errorMsg),self.setState({error:"An error occurred when loading the form!"})}})}},{key:"render",value:function(){if(void 0!==this.state.error)return React.createElement("div",{className:"alert alert-danger text-center"},React.createElement("strong",null,this.state.error));if(!this.state.isLoaded)return React.createElement("button",{className:"btn-info has-spinner"},"Loading",React.createElement("span",{className:"glyphicon glyphicon-refresh glyphicon-refresh-animate"}));var helpText=React.createElement("span",null,"Editing an entry will deactivate the current entry and create a new entry.",React.createElement("br",null),"You cannot edit an entry to have the same values as another active entry.",React.createElement("br",null),"If the edited entry has the same values as another deactivated entry,",React.createElement("br",null),"you can activate the other entry and deactivate the current entry.",React.createElement("br",null),React.createElement("br",null));return React.createElement("div",null,React.createElement(FormElement,{name:"batteryEdit",onSubmit:this.handleEdit,ref:"form"},React.createElement("h3",null,"Edit entry in Test Battery"),React.createElement("br",null),React.createElement(StaticElement,{label:"Note",text:helpText}),React.createElement(SelectElement,{name:"instrument",label:"Instrument",options:this.state.Data.instruments,onUserInput:this.setFormData,ref:"instrument",required:!0,value:this.state.formData.instrument}),React.createElement(NumericElement,{name:"ageMinDays",label:"Minimum age (days)",onUserInput:this.setFormData,ref:"ageMinDays",required:!0,min:"0",max:"99999",value:this.state.formData.ageMinDays}),React.createElement(NumericElement,{name:"ageMaxDays",label:"Maximum age (days)",onUserInput:this.setFormData,ref:"ageMaxDays",required:!0,min:"0",max:"99999",value:this.state.formData.ageMaxDays}),React.createElement(SelectElement,{name:"stage",label:"Stage",options:this.state.Data.stages,onUserInput:this.setFormData,ref:"stage",hasError:!1,required:!0,value:this.state.formData.stage}),React.createElement(SelectElement,{name:"subproject",label:"Subproject",options:this.state.Data.subprojects,onUserInput:this.setFormData,ref:"subproject",hasError:!1,required:!1,value:this.state.formData.subproject}),React.createElement(SelectElement,{name:"visitLabel",label:"Visit Label",options:this.state.Data.visits,onUserInput:this.setFormData,ref:"visitLabel",required:!1,value:this.state.formData.visitLabel}),React.createElement(SelectElement,{name:"forSite",label:"Site",options:this.state.Data.sites,onUserInput:this.setFormData,ref:"forSite",required:!1,value:this.state.formData.forSite}),React.createElement(SelectElement,{name:"firstVisit",label:"First Visit",options:this.state.Data.firstVisits,onUserInput:this.setFormData,ref:"firstVisit",required:!1,value:this.state.formData.firstVisit}),React.createElement(NumericElement,{name:"instrumentOrder",label:"Instrument Order",onUserInput:this.setFormData,ref:"instrumentOrder",required:!1,min:"0",max:"127",value:this.state.formData.instrumentOrder}),React.createElement(ButtonElement,{label:"Edit entry"})))}},{key:"handleEdit",value:function(e){e.preventDefault();var formData=this.state.formData,formObj=new FormData;for(var key in formData)null!==formData[key]&&formObj.append(key,formData[key]);this.isDuplicate(formObj,this.giveOptions)}},{key:"isDuplicate",value:function(formObj,callback){$.ajax({type:"POST",url:this.props.checkForDuplicate,data:formObj,cache:!1,contentType:!1,processData:!1,success:callback,error:function(err){console.error(err),swal("Could not check","","error")}})}},{key:"giveOptions",value:function(duplicate){var formData=this.state.formData,currentEntry=new FormData;if(currentEntry.append("ID",formData.id),Object.keys(duplicate).length>0){var duplicateEntryJSON=JSON.parse(duplicate),duplicateEntry=new FormData;duplicateEntry.append("ID",duplicateEntryJSON.ID),formData.id===duplicateEntryJSON.ID?swal({title:"Duplicate entry!",text:"You did not make any changes to the current entry.",type:"error"}):"Y"===duplicateEntryJSON.Active?swal({title:"Duplicate entry!",text:"This entry already already exists in the database.",type:"error"}):"N"===duplicateEntryJSON.Active&&swal({title:"Deactivated entry!",text:"A deactivated entry with these values already exists!\n Would you like to reactivate this entry and deactivate the current one?",type:"warning",showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"Cancel",closeOnConfirm:!1},function(){this.activateEntry(duplicateEntry,currentEntry)}.bind(this))}else{var newEntry=new FormData;for(var key in formData)formData.hasOwnProperty(key)&&newEntry.append(key,formData[key]);this.addEntry(newEntry,currentEntry)}}},{key:"activateEntry",value:function(duplicateEntry,currentEntry){$.ajax({type:"POST",url:this.props.activate,data:duplicateEntry,cache:!1,contentType:!1,processData:!1}).done(function(data){this.deactivateEntry(currentEntry)}.bind(this)).error(function(data){swal("Could not activate other entry","","error")})}},{key:"addEntry",value:function(newEntry,currentEntry){$.ajax({type:"POST",url:this.props.add,data:newEntry,cache:!1,contentType:!1,processData:!1}).done(function(data){this.deactivateEntry(currentEntry)}.bind(this)).error(function(data){swal("Could not add new entry","","error")})}},{key:"deactivateEntry",value:function(currentEntry){$.ajax({type:"POST",url:this.props.deactivate,data:currentEntry,cache:!1,contentType:!1,processData:!1}).done(function(data){swal({title:"Edit successful!",type:"success"},function(){window.location.assign(loris.BaseURL+"/battery_manager/")}.bind(this))}).error(function(data){swal("Could not deactivate current entry","","error")})}},{key:"setFormData",value:function(formElement,value){var formData=this.state.formData;""===value?formData[formElement]=null:formData[formElement]=value,this.setState({formData:formData})}}]),BatteryManagerEditForm}(React.Component),args=QueryString.get(document.currentScript.src);$(function(){var batteryManagerEditForm=React.createElement("div",{className:"page-edit-entry"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-9 col-lg-7"},React.createElement(BatteryManagerEditForm,{DataURL:loris.BaseURL+"/battery_manager/ajax/get_form_data.php?form=edit&ID="+args.id,checkForDuplicate:loris.BaseURL+"/battery_manager/ajax/add_entry.php?action=checkForDuplicate",activate:loris.BaseURL+"/battery_manager/ajax/change_active_status.php?action=activate",deactivate:loris.BaseURL+"/battery_manager/ajax/change_active_status.php?action=deactivate",add:loris.BaseURL+"/battery_manager/ajax/add_entry.php?action=add"}))));ReactDOM.render(batteryManagerEditForm,document.getElementById("lorisworkspace"))})}]);
//# sourceMappingURL=editEntry.js.map