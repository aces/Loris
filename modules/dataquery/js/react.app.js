(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=29)})({0:function(module,exports,__webpack_require__){"use strict";if(true){module.exports=__webpack_require__(2)}else{}},1:function(module,exports,__webpack_require__){if(false){var throwOnDirectAccess,isValidElement,REACT_ELEMENT_TYPE}else{module.exports=__webpack_require__(4)()}},2:function(module,exports,__webpack_require__){"use strict";
/** @license React v16.5.2
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var m=__webpack_require__(3),n="function"===typeof Symbol&&Symbol.for,p=n?Symbol.for("react.element"):60103,q=n?Symbol.for("react.portal"):60106,r=n?Symbol.for("react.fragment"):60107,t=n?Symbol.for("react.strict_mode"):60108,u=n?Symbol.for("react.profiler"):60114,v=n?Symbol.for("react.provider"):60109,w=n?Symbol.for("react.context"):60110,x=n?Symbol.for("react.async_mode"):60111,y=n?Symbol.for("react.forward_ref"):60112;n&&Symbol.for("react.placeholder");var z="function"===typeof Symbol&&Symbol.iterator;function A(a,b,d,c,e,g,h,f){if(!a){a=void 0;if(void 0===b)a=Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var k=[d,c,e,g,h,f],l=0;a=Error(b.replace(/%s/g,function(){return k[l++]}));a.name="Invariant Violation"}a.framesToPop=1;throw a}}function B(a){for(var b=arguments.length-1,d="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=0;c<b;c++)d+="&args[]="+encodeURIComponent(arguments[c+1]);A(!1,"Minified React error #"+a+"; visit %s for the full message or use the non-minified dev environment for full errors and additional helpful warnings. ",d)}var C={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},D={};function E(a,b,d){this.props=a;this.context=b;this.refs=D;this.updater=d||C}E.prototype.isReactComponent={};E.prototype.setState=function(a,b){"object"!==typeof a&&"function"!==typeof a&&null!=a?B("85"):void 0;this.updater.enqueueSetState(this,a,b,"setState")};E.prototype.forceUpdate=function(a){this.updater.enqueueForceUpdate(this,a,"forceUpdate")};function F(){}F.prototype=E.prototype;function G(a,b,d){this.props=a;this.context=b;this.refs=D;this.updater=d||C}var H=G.prototype=new F;H.constructor=G;m(H,E.prototype);H.isPureReactComponent=!0;var I={current:null,currentDispatcher:null},J=Object.prototype.hasOwnProperty,K={key:!0,ref:!0,__self:!0,__source:!0};function L(a,b,d){var c=void 0,e={},g=null,h=null;if(null!=b)for(c in void 0!==b.ref&&(h=b.ref),void 0!==b.key&&(g=""+b.key),b)J.call(b,c)&&!K.hasOwnProperty(c)&&(e[c]=b[c]);var f=arguments.length-2;if(1===f)e.children=d;else if(1<f){for(var k=Array(f),l=0;l<f;l++)k[l]=arguments[l+2];e.children=k}if(a&&a.defaultProps)for(c in f=a.defaultProps,f)void 0===e[c]&&(e[c]=f[c]);return{$$typeof:p,type:a,key:g,ref:h,props:e,_owner:I.current}}function M(a,b){return{$$typeof:p,type:a.type,key:b,ref:a.ref,props:a.props,_owner:a._owner}}function N(a){return"object"===typeof a&&null!==a&&a.$$typeof===p}function escape(a){var b={"=":"=0",":":"=2"};return"$"+(""+a).replace(/[=:]/g,function(a){return b[a]})}var O=/\/+/g,P=[];function Q(a,b,d,c){if(P.length){var e=P.pop();e.result=a;e.keyPrefix=b;e.func=d;e.context=c;e.count=0;return e}return{result:a,keyPrefix:b,func:d,context:c,count:0}}function R(a){a.result=null;a.keyPrefix=null;a.func=null;a.context=null;a.count=0;10>P.length&&P.push(a)}function S(a,b,d,c){var e=typeof a;if("undefined"===e||"boolean"===e)a=null;var g=!1;if(null===a)g=!0;else switch(e){case"string":case"number":g=!0;break;case"object":switch(a.$$typeof){case p:case q:g=!0}}if(g)return d(c,a,""===b?"."+T(a,0):b),1;g=0;b=""===b?".":b+":";if(Array.isArray(a))for(var h=0;h<a.length;h++){e=a[h];var f=b+T(e,h);g+=S(e,f,d,c)}else if(null===a||"object"!==typeof a?f=null:(f=z&&a[z]||a["@@iterator"],f="function"===typeof f?f:null),"function"===typeof f)for(a=f.call(a),h=0;!(e=a.next()).done;)e=e.value,f=b+T(e,h++),g+=S(e,f,d,c);else"object"===e&&(d=""+a,B("31","[object Object]"===d?"object with keys {"+Object.keys(a).join(", ")+"}":d,""));return g}function U(a,b,d){return null==a?0:S(a,"",b,d)}function T(a,b){return"object"===typeof a&&null!==a&&null!=a.key?escape(a.key):b.toString(36)}function V(a,b){a.func.call(a.context,b,a.count++)}function aa(a,b,d){var c=a.result,e=a.keyPrefix;a=a.func.call(a.context,b,a.count++);Array.isArray(a)?W(a,c,d,function(a){return a}):null!=a&&(N(a)&&(a=M(a,e+(!a.key||b&&b.key===a.key?"":(""+a.key).replace(O,"$&/")+"/")+d)),c.push(a))}function W(a,b,d,c,e){var g="";null!=d&&(g=(""+d).replace(O,"$&/")+"/");b=Q(b,g,c,e);U(a,aa,b);R(b)}function ba(a,b){var d=I.currentDispatcher;null===d?B("277"):void 0;return d.readContext(a,b)}var X={Children:{map:function(a,b,d){if(null==a)return a;var c=[];W(a,c,null,b,d);return c},forEach:function(a,b,d){if(null==a)return a;b=Q(null,null,b,d);U(a,V,b);R(b)},count:function(a){return U(a,function(){return null},null)},toArray:function(a){var b=[];W(a,b,null,function(a){return a});return b},only:function(a){N(a)?void 0:B("143");return a}},createRef:function(){return{current:null}},Component:E,PureComponent:G,createContext:function(a,b){void 0===b&&(b=null);a={$$typeof:w,_calculateChangedBits:b,_currentValue:a,_currentValue2:a,Provider:null,Consumer:null,unstable_read:null};a.Provider={$$typeof:v,_context:a};a.Consumer=a;a.unstable_read=ba.bind(null,a);return a},forwardRef:function(a){return{$$typeof:y,render:a}},Fragment:r,StrictMode:t,unstable_AsyncMode:x,unstable_Profiler:u,createElement:L,cloneElement:function(a,b,d){null===a||void 0===a?B("267",a):void 0;var c=void 0,e=m({},a.props),g=a.key,h=a.ref,f=a._owner;if(null!=b){void 0!==b.ref&&(h=b.ref,f=I.current);void 0!==b.key&&(g=""+b.key);var k=void 0;a.type&&a.type.defaultProps&&(k=a.type.defaultProps);for(c in b)J.call(b,c)&&!K.hasOwnProperty(c)&&(e[c]=void 0===b[c]&&void 0!==k?k[c]:b[c])}c=arguments.length-2;if(1===c)e.children=d;else if(1<c){k=Array(c);for(var l=0;l<c;l++)k[l]=arguments[l+2];e.children=k}return{$$typeof:p,type:a.type,key:g,ref:h,props:e,_owner:f}},createFactory:function(a){var b=L.bind(null,a);b.type=a;return b},isValidElement:N,version:"16.5.2",__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{ReactCurrentOwner:I,assign:m}},Y={default:X},Z=Y&&X||Y;module.exports=Z.default||Z},29:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0);var react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);var prop_types__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1);var prop_types__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(prop_types__WEBPACK_IMPORTED_MODULE_1__);function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}
/**
 *  The following file contains the base component for the data query react app.
 *  It also contains the component for the saved queries dropdown.
 *
 *  @author   Jordan Stirling <jstirling91@gmail.com>
 *  @author   Dave MacFarlane <david.macfarlane2@mcgill.ca>
 *  @license  http://www.gnu.org/licenses/gpl-3.0.txt GPLv3
 *  @link     https://github.com/mohadesz/Loris-Trunk
 */var SavedQueriesList=function(_Component){_inherits(SavedQueriesList,_Component);function SavedQueriesList(props){var _this;_classCallCheck(this,SavedQueriesList);_this=_possibleConstructorReturn(this,_getPrototypeOf(SavedQueriesList).call(this,props));_this.state={};_this.loadQuery=_this.loadQuery.bind(_assertThisInitialized(_assertThisInitialized(_this)));return _this}_createClass(SavedQueriesList,[{key:"componentDidMount",value:function componentDidMount(){}},{key:"loadQuery",value:function loadQuery(queryName){this.props.onSelectQuery(this.props.queryDetails[queryName].Fields,this.props.queryDetails[queryName].Conditions)}},{key:"render",value:function render(){var userSaved=[];var globalSaved=[];var queryName,curQuery;if(this.props.queriesLoaded===false){return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div",null)}for(var i=0;i<this.props.userQueries.length;i+=1){curQuery=this.props.queryDetails[this.props.userQueries[i]];console.log(curQuery.Meta);if(curQuery.Meta&&curQuery.Meta.name){queryName=curQuery.Meta.name}else{queryName=this.props.userQueries[i]}userSaved.push(react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("li",{key:this.props.userQueries[i]},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("a",{href:"#",onClick:this.loadQuery.bind(this,this.props.userQueries[i])},queryName)))}for(var _i=0;_i<this.props.globalQueries.length;_i+=1){curQuery=this.props.queryDetails[this.props.globalQueries[_i]];console.log(curQuery.Meta);if(curQuery.Meta&&curQuery.Meta.name){queryName=curQuery.Meta.name}else{queryName=this.props.globalQueries[_i]}globalSaved.push(react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("li",{key:this.props.globalQueries[_i]},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("a",{href:"#",onClick:this.loadQuery.bind(this,this.props.globalQueries[_i])},queryName)))}return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("ul",{className:"nav nav-tabs navbar-right"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("li",{className:"dropdown"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("a",{href:"#",className:"dropdown-toggle","data-toggle":"dropdown",role:"button","aria-expanded":"false"},"Load Saved Query ",react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("span",{className:"caret"})),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("ul",{className:"dropdown-menu",role:"menu"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("li",{role:"presentation",className:"dropdown-header"},"User Saved Queries"),userSaved,react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("li",{role:"presentation",className:"dropdown-header"},"Shared Saved Queries"),globalSaved)),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("li",{role:"presentation"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("a",{href:"#SavedQueriesTab","data-toggle":"tab"},"Manage Saved Queries")))}}]);return SavedQueriesList}(react__WEBPACK_IMPORTED_MODULE_0__["Component"]);SavedQueriesList.propTypes={queryDetails:prop_types__WEBPACK_IMPORTED_MODULE_1___default.a.array,queriesLoaded:prop_types__WEBPACK_IMPORTED_MODULE_1___default.a.bool};SavedQueriesList.defaultProps={queryDetails:[],queriesLoaded:false};var DataQueryApp=function(_Component2){_inherits(DataQueryApp,_Component2);function DataQueryApp(props){var _this2;_classCallCheck(this,DataQueryApp);_this2=_possibleConstructorReturn(this,_getPrototypeOf(DataQueryApp).call(this,props));_this2.state={displayType:"Cross-sectional",fields:[],criteria:{},sessiondata:{},grouplevel:0,queryIDs:_this2.props.SavedQueries,savedQueries:{},queriesLoaded:false,alertLoaded:false,alertSaved:false,alertConflict:{show:false},ActiveTab:"Info",rowData:{},filter:{type:"group",activeOperator:0,children:[{type:"rule"}],session:_this2.props.AllSessions},selectedFields:{},downloadableFields:{},loading:false};_this2.saveFilterRule=_this2.saveFilterRule.bind(_assertThisInitialized(_assertThisInitialized(_this2)));_this2.saveFilterGroup=_this2.saveFilterGroup.bind(_assertThisInitialized(_assertThisInitialized(_this2)));_this2.saveCurrentQuery=_this2.saveCurrentQuery.bind(_assertThisInitialized(_assertThisInitialized(_this2)));_this2.overrideQuery=_this2.overrideQuery.bind(_assertThisInitialized(_assertThisInitialized(_this2)));_this2.loadFilterRule=_this2.loadFilterRule.bind(_assertThisInitialized(_assertThisInitialized(_this2)));_this2.loadFilterGroup=_this2.loadFilterGroup.bind(_assertThisInitialized(_assertThisInitialized(_this2)));_this2.loadSavedQuery=_this2.loadSavedQuery.bind(_assertThisInitialized(_assertThisInitialized(_this2)));_this2.fieldVisitSelect=_this2.fieldVisitSelect.bind(_assertThisInitialized(_assertThisInitialized(_this2)));_this2.fieldChange=_this2.fieldChange.bind(_assertThisInitialized(_assertThisInitialized(_this2)));_this2.getSessions=_this2.getSessions.bind(_assertThisInitialized(_assertThisInitialized(_this2)));_this2.runQuery=_this2.runQuery.bind(_assertThisInitialized(_assertThisInitialized(_this2)));_this2.getRowData=_this2.getRowData.bind(_assertThisInitialized(_assertThisInitialized(_this2)));_this2.dismissAlert=_this2.dismissAlert.bind(_assertThisInitialized(_assertThisInitialized(_this2)));_this2.resetQuery=_this2.resetQuery.bind(_assertThisInitialized(_assertThisInitialized(_this2)));_this2.changeDataDisplay=_this2.changeDataDisplay.bind(_assertThisInitialized(_assertThisInitialized(_this2)));_this2.updateFilter=_this2.updateFilter.bind(_assertThisInitialized(_assertThisInitialized(_this2)));return _this2}_createClass(DataQueryApp,[{key:"componentDidMount",value:function componentDidMount(){var domNode=this;$(domNode).find('a[data-toggle="tab"]').on("shown.bs.tab",function(e){$(domNode).find("li").removeClass("active");if(e.target){e.target.classList.add("active");if(e.target.parentNode){e.target.parentNode.classList.add("active")}}});var promises=[];for(var key in this.state.queryIDs){console.log(this.state.queryIDs[key][0]);for(var i=0;i<this.state.queryIDs[key].length;i+=1){var curRequest=void 0;curRequest=Promise.resolve($.ajax(loris.BaseURL+"/AjaxHelper.php?Module=dataquery&script=GetDoc.php&DocID="+that.state.queryIDs[key][i]),{data:{DocID:this.state.queryIDs[key][i]},dataType:"json"}).then(function(value){var queries=this.state.savedQueries;queries[value._id]=value;this.setState({savedQueries:queries})});promises.push(curRequest)}}var allDone=Promise.all(promises).then(function(value){this.setState({queriesLoaded:true})});var component=this;$('a[data-toggle="tab"]').on("shown.bs.tab",function(e){component.setState({ActiveTab:e.target.getAttribute("href").substr(1)})})}},{key:"saveFilterRule",value:function saveFilterRule(rule){var savedRule={field:rule.field,operator:rule.operator,value:rule.value,instrument:rule.instrument,visit:rule.visit};return savedRule}},{key:"saveFilterGroup",value:function saveFilterGroup(group){var savedFilter={activeOperator:group.activeOperator,children:[]};for(var i=0;i<group.children.length;i++){if(group.children[i].type==="rule"){savedFilter.children.push(this.saveFilterRule(group.children[i]))}else if(group.children[i].type==="group"){savedFilter.children.push(this.saveFilterGroup(group.children[i]))}}return savedFilter}},{key:"saveCurrentQuery",value:function saveCurrentQuery(name,shared,override){var filter=this.saveFilterGroup(this.state.filter);$.post(loris.BaseURL+"/AjaxHelper.php?Module=dataquery&script=saveQuery.php",{Fields:this.state.selectedFields,Filters:filter,QueryName:name,SharedQuery:shared,OverwriteQuery:override},function(data){var id=JSON.parse(data).id,queryIDs=this.state.queryIDs;if(!override){if(shared===true){queryIDs.Shared.push(id)}else{queryIDs.User.push(id)}}$.get(loris.BaseURL+"/AjaxHelper.php?Module=dataquery&script=GetDoc.php&DocID="+id,function(value){var queries=that.state.savedQueries;queries[value._id]=value;this.setState({savedQueries:queries,queryIDs:queryIDs,alertLoaded:false,alertSaved:true,alertConflict:{show:false}})})}).fail(function(data){if(data.status===409){this.setState({alertConflict:{show:true,QueryName:name,SharedQuery:shared}})}})}},{key:"overrideQuery",value:function overrideQuery(){this.saveCurrentQuery(this.state.alertConflict.QueryName,this.state.alertConflict.SharedQuery,true)}},{key:"loadFilterRule",value:function loadFilterRule(rule){var script;if(!rule.type){rule.type="rule"}$.ajax({url:loris.BaseURL+"/AjaxHelper.php?Module=dataquery&script=datadictionary.php",success:function success(data){rule.fields=data},async:false,data:{category:rule.instrument},dataType:"json"});for(var i=0;i<rule.fields.length;i++){if(rule.fields[i].key[1]===rule.field){rule.fieldType=rule.fields[i].value.Type;break}}switch(rule.operator){case"equal":case"isNull":script="queryEqual.php";break;case"notEqual":case"isNotNull":script="queryNotEqual.php";break;case"lessThanEqual":script="queryLessThanEqual.php";break;case"greaterThanEqual":script="queryGreaterThanEqual.php";break;case"startsWith":script="queryStartsWith.php";break;case"contains":script="queryContains.php";break;default:break}$.ajax({url:loris.BaseURL+"/AjaxHelper.php?Module=dataquery&script="+script,success:function success(data){var i,allSessions={},allCandiates={};for(i=0;i<data.length;i++){if(!allSessions[data[i][1]]){allSessions[data[i][1]]=[]}allSessions[data[i][1]].push(data[i][0]);if(!allCandiates[data[i][0]]){allCandiates[data[i][0]]=[]}allCandiates[data[i][0]].push(data[i][1])}rule.candidates={allCandiates:allCandiates,allSessions:allSessions};if(rule.visit==="All"){rule.session=Object.keys(allCandiates)}else{if(allSessions[rule.visit]){rule.session=allSessions[rule.visit]}else{rule.session=[]}}},async:false,data:{category:rule.instrument,field:rule.field,value:rule.value},dataType:"json"});return rule}},{key:"loadFilterGroup",value:function loadFilterGroup(group){for(var i=0;i<group.children.length;i++){if(group.children[i].activeOperator){if(!group.children[i].type){group.children[i].type="group"}group.children[i]=this.loadFilterGroup(group.children[i])}else{group.children[i]=this.loadFilterRule(group.children[i])}}group.session=getSessions(group);return group}},{key:"loadSavedQuery",value:function loadSavedQuery(fields,criteria){var _this3=this;var filterState={},selectedFields={},fieldsList=[];this.setState({loading:true});if(Array.isArray(criteria)){filterState={type:"group",activeOperator:0,children:[]};filterState.children=criteria.map(function(item){var fieldInfo=item.Field.split(",");var rule={instrument:fieldInfo[0],field:fieldInfo[1],value:item.Value,type:"rule",visit:"All"};switch(item.Operator){case"=":rule.operator="equal";break;case"!=":rule.operator="notEqual";break;case"<=":rule.operator="lessThanEqual";break;case">=":rule.operator="greaterThanEqual";break;default:rule.operator=item.Operator;break}return rule});var fieldSplit;fieldsList=fields;for(var i=0;i<fields.length;i++){fieldSplit=fields[i].split(",");if(!selectedFields[fieldSplit[0]]){selectedFields[fieldSplit[0]]={};selectedFields[fieldSplit[0]][fieldSplit[1]]={};selectedFields[fieldSplit[0]].allVisits={};for(var key in this.props.Visits){selectedFields[fieldSplit[0]].allVisits[key]=1;selectedFields[fieldSplit[0]][fieldSplit[1]][key]=[key]}}else{selectedFields[fieldSplit[0]][fieldSplit[1]]={};for(var _key in this.props.Visits){selectedFields[fieldSplit[0]].allVisits[_key]++;selectedFields[fieldSplit[0]][fieldSplit[1]][_key]=[_key]}}}}else{filterState=criteria;selectedFields=fields;for(var instrument in fields){for(var field in fields[instrument]){if(field!=="allVisits"){fieldsList.push(instrument+","+field)}}}}if(filterState.children&&filterState.children.length>0){filterState=this.loadFilterGroup(filterState)}else{filterState.children=[{type:"rule"}];filterState.session=this.props.AllSessions}this.setState(function(state){return{fields:fieldsList,selectedFields:selectedFields,filter:filterState,alertLoaded:true,alertSaved:false,loading:false}});var _loop=function _loop(_i2){var that=_this3;$.ajax({url:loris.BaseURL+"/dataquery/ajax/datadictionary.php",success:function success(data){if(data[0].value.IsFile){that.setState(function(state){var key=data[0].key[0]+","+data[0].key[1];var downloadable=state.downloadableFields;downloadable[key]=true;return{downloadableFields:downloadable}})}},data:{key:fieldsList[_i2]},dataType:"json"})};for(var _i2=0;_i2<fieldsList.length;_i2++){_loop(_i2)}}},{key:"fieldVisitSelect",value:function fieldVisitSelect(action,visit,field){this.setState(function(state){var temp=state.selectedFields[field.instrument];if(action==="check"){temp[field.field][visit]=visit;if(temp.allVisits[visit]){temp.allVisits[visit]++}else{temp.allVisits[visit]=1}}else{delete temp[field.field][visit];if(temp.allVisits[visit]===1){delete temp.allVisits[visit]}else{temp.allVisits[visit]--}}return temp})}},{key:"fieldChange",value:function fieldChange(fieldName,category,downloadable){var that=this;this.setState(function(state){var selectedFields=state.selectedFields,fields=state.fields.slice(0);if(!selectedFields[category]){selectedFields[category]={};selectedFields[category][fieldName]=JSON.parse(JSON.stringify(that.props.Visits));selectedFields[category].allVisits={};for(var key in that.props.Visits){selectedFields[category].allVisits[key]=1}fields.push(category+","+fieldName);if(downloadable){state.downloadableFields[category+","+fieldName]=true}}else if(selectedFields[category][fieldName]){for(var _key2 in selectedFields[category][fieldName]){if(selectedFields[category].allVisits[_key2]===1){delete selectedFields[category].allVisits[_key2]}else{selectedFields[category].allVisits[_key2]--}}delete selectedFields[category][fieldName];var idx=fields.indexOf(category+","+fieldName);fields.splice(idx,1);if(Object.keys(selectedFields[category]).length===1){delete selectedFields[category]}if(downloadable){delete state.downloadableFields[category+","+fieldName]}}else{if(!selectedFields[category][fieldName]){selectedFields[category][fieldName]={}}for(var _key3 in selectedFields[category].allVisits){if(_key3==="allVisits"){continue}selectedFields[category].allVisits[_key3]++;selectedFields[category][fieldName][_key3]=_key3}fields.push(category+","+fieldName);if(downloadable){state.downloadableFields[category+","+fieldName]=true}}return{selectedFields:selectedFields,fields:fields}})}},{key:"getSessions",value:function getSessions(){if(this.state.filter.children.length>0){return this.state.filter.session}else{return this.props.AllSessions}}},{key:"runQuery",value:function runQuery(fields,sessions){var DocTypes=[],that=this,semaphore=0,sectionedSessions,ajaxComplete=function ajaxComplete(){if(semaphore==0){var rowdata=that.getRowData(that.state.grouplevel);that.setState({rowData:rowdata,loading:false})}};this.setState({rowData:{},sessiondata:{},loading:true});for(var i=0;i<fields.length;i+=1){var field_split=fields[i].split(",");var category=field_split[0];if(DocTypes.indexOf(category)===-1){var sessionInfo=[];for(var j=0;j<this.state.filter.session.length;j++){if(Array.isArray(this.state.filter.session[j])){if(this.state.selectedFields[category].allVisits[this.state.filter.session[j][1]]){sessionInfo.push(this.state.filter.session[j])}}else{for(var key in this.state.selectedFields[category].allVisits){var temp=[];temp.push(this.state.filter.session[j]);temp.push(key);sessionInfo.push(temp)}}}DocTypes.push(category);semaphore++;sectionedSessions=JSON.stringify(sessionInfo);$.ajax({type:"POST",url:loris.BaseURL+"/AjaxHelper.php?Module=dataquery&script=retrieveCategoryDocs.php",data:{DocType:category,Sessions:sectionedSessions},dataType:"text",success:function success(data){if(data){var _i3,row,rows,identifier,sessiondata=that.state.sessiondata;data=JSON.parse(data);rows=data.rows;for(_i3=0;_i3<rows.length;_i3+=1){row=rows[_i3];identifier=row.value;if(!sessiondata.hasOwnProperty(identifier)){sessiondata[identifier]={}}sessiondata[identifier][row.key[0]]=row.doc}that.setState({sessiondata:sessiondata})}console.log("Received data");semaphore--;ajaxComplete()}})}}}},{key:"getRowData",value:function getRowData(displayID){var sessiondata=this.state.sessiondata;var sessions=this.getSessions();var fields=this.state.fields.sort();var downloadableFields=this.state.downloadableFields;var i,j;var rowdata=[];var currow=[];var Identifiers=[];var RowHeaders=[];var fileData=[];var href;if(displayID===0){for(i=0;fields&&i<fields.length;i+=1){RowHeaders.push(fields[i])}for(var session in sessiondata){currow=[];for(i=0;fields&&i<fields.length;i+=1){var fieldSplit=fields[i].split(",");currow[i]=".";var sd=sessiondata[session];if(sd[fieldSplit[0]]&&sd[fieldSplit[0]].data[fieldSplit[1]]&&downloadableFields[fields[i]]){href=loris.BaseURL+"/mri/jiv/get_file.php?file="+sd[fieldSplit[0]].data[fieldSplit[1]];currow[i]=react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("a",{href:href},sd[fieldSplit[0]].data[fieldSplit[1]]);fileData.push("file/"+sd[fieldSplit[0]]._id+"/"+encodeURIComponent(sd[fieldSplit[0]].data[fieldSplit[1]]))}else if(sd[fieldSplit[0]]){currow[i]=sd[fieldSplit[0]].data[fieldSplit[1]]}}rowdata.push(currow);Identifiers.push(session)}}else{var Visits={},visit,identifier,temp,colHeader,index,instrument,_fieldSplit;for(var _session in sessiondata){temp=_session.split(",");visit=temp[1];if(!Visits[visit]){Visits[visit]=true}identifier=temp[0];if(Identifiers.indexOf(identifier)===-1){Identifiers.push(identifier)}}for(i=0;fields&&i<fields.length;i+=1){for(visit in Visits){temp=fields[i].split(",");instrument=this.state.selectedFields[temp[0]];if(instrument&&instrument[temp[1]]&&instrument[temp[1]][visit]){RowHeaders.push(visit+" "+fields[i])}}}for(identifier in Identifiers){currow=[];for(colHeader in RowHeaders){temp=Identifiers[identifier]+","+RowHeaders[colHeader].split(" ")[0];index=sessiondata[temp];if(!index){currow.push(".")}else{temp=index[RowHeaders[colHeader].split(",")[0].split(" ")[1]];_fieldSplit=RowHeaders[colHeader].split(" ")[1].split(",");if(temp){if(temp.data[RowHeaders[colHeader].split(",")[1]]&&downloadableFields[_fieldSplit[0]+","+_fieldSplit[1]]){href=loris.BaseURL+"/mri/jiv/get_file.php?file="+temp.data[RowHeaders[colHeader].split(",")[1]];temp=react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("a",{href:href},temp.data[RowHeaders[colHeader].split(",")[1]])}else{temp=temp.data[RowHeaders[colHeader].split(",")[1]]}}else{temp="."}currow.push(temp)}}rowdata.push(currow)}}return{rowdata:rowdata,Identifiers:Identifiers,RowHeaders:RowHeaders,fileData:fileData}}},{key:"dismissAlert",value:function dismissAlert(){this.setState({alertLoaded:false,alertSaved:false,alertConflict:{show:false}})}},{key:"resetQuery",value:function resetQuery(){this.setState({fields:[],criteria:{},selectedFields:{}})}},{key:"changeDataDisplay",value:function changeDataDisplay(displayID){var rowdata=this.getRowData(displayID);this.setState({grouplevel:displayID,rowData:rowdata})}},{key:"updateFilter",value:function updateFilter(filter){var that=this;this.setState(function(state){if(filter.children.length===0){filter.session=that.props.AllSessions}return{filter:filter}})}},{key:"render",value:function render(){var tabs=[],tabsNav=[],alert=react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div",null);tabs.push(react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(InfoTabPane,{TabId:"Info",UpdatedTime:this.props.UpdatedTime,Loading:this.state.loading}));tabs.push(react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(FieldSelectTabPane,{TabId:"DefineFields",categories:this.props.categories,onFieldChange:this.fieldChange,selectedFields:this.state.selectedFields,Visits:this.props.Visits,fieldVisitSelect:this.fieldVisitSelect,Loading:this.state.loading}));tabs.push(react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(FilterSelectTabPane,{TabId:"DefineFilters",categories:this.props.categories,filter:this.state.filter,updateFilter:this.updateFilter,Visits:this.props.Visits,Loading:this.state.loading}));var displayType=this.state.grouplevel===0?"Cross-sectional":"Longitudinal";tabs.push(react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(ViewDataTabPane,{TabId:"ViewData",Fields:this.state.fields,Criteria:this.state.criteria,Sessions:this.getSessions(),Data:this.state.rowData.rowdata,RowInfo:this.state.rowData.Identifiers,RowHeaders:this.state.rowData.RowHeaders,FileData:this.state.rowData.fileData,onRunQueryClicked:this.runQuery,displayType:displayType,changeDataDisplay:this.changeDataDisplay,Loading:this.state.loading,runQuery:this.runQuery}));tabs.push(react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(StatsVisualizationTabPane,{TabId:"Statistics",Fields:this.state.rowData.RowHeaders,Data:this.state.rowData.rowdata,Loading:this.state.loading}));tabs.push(react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(ManageSavedQueriesTabPane,{TabId:"SavedQueriesTab",userQueries:this.state.queryIDs.User,globalQueries:this.state.queryIDs.Shared,onSaveQuery:this.saveCurrentQuery,queryDetails:this.state.savedQueries,queriesLoaded:this.state.queriesLoaded,Loading:this.state.loading}));if(this.state.alertLoaded){alert=react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div",{className:"alert alert-success",role:"alert"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("button",{type:"button",className:"close","aria-label":"Close",onClick:this.dismissAlert},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("span",{"aria-hidden":"true"},"×")),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("strong",null,"Success")," Query Loaded.")}if(this.state.alertSaved){alert=react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div",{className:"alert alert-success",role:"alert"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("button",{type:"button",className:"close","aria-label":"Close",onClick:this.dismissAlert},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("span",{"aria-hidden":"true"},"×")),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("strong",null,"Success")," Query Saved.")}if(this.state.alertConflict.show){alert=react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div",{className:"alert alert-warning",role:"alert"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("button",{type:"button",className:"close","aria-label":"Close",onClick:this.dismissAlert},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("span",{"aria-hidden":"true"},"×")),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("button",{type:"button",className:"close","aria-label":"Close",onClick:this.dismissAlert},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("span",{"aria-hidden":"true"},"Override")),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("strong",null,"Error")," Query with the same name already exists.",react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("a",{href:"#",class:"alert-link",onClick:this.overrideQuery},"Click here to override"))}var widthClass="col-md-12";var sideBar=react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div",null);if(this.state.fields.length>0&&this.state.ActiveTab!=="ViewData"&&this.state.ActiveTab!=="Statistics"&&this.state.ActiveTab!=="Info"){widthClass="col-md-10";sideBar=react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div",{className:"col-md-2"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(FieldsSidebar,{Fields:this.state.fields,Criteria:this.state.criteria,resetQuery:this.resetQuery}))}return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div",null,alert,react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div",{className:widthClass},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("nav",{className:"nav nav-tabs"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("ul",{className:"nav nav-tabs navbar-left","data-tabs":"tabs"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("li",{role:"presentation",className:"active"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("a",{href:"#Info","data-toggle":"tab"},"Info")),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("li",{role:"presentation"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("a",{href:"#DefineFields","data-toggle":"tab"},"Define Fields")),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("li",{role:"presentation"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("a",{href:"#DefineFilters","data-toggle":"tab"},"Define Filters")),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("li",{role:"presentation"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("a",{href:"#ViewData","data-toggle":"tab"},"View Data")),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("li",{role:"presentation"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("a",{href:"#Statistics","data-toggle":"tab"},"Statistical Analysis"))),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(SavedQueriesList,{userQueries:this.state.queryIDs.User,globalQueries:this.state.queryIDs.Shared,queryDetails:this.state.savedQueries,queriesLoaded:this.state.queriesLoaded,onSelectQuery:this.loadSavedQuery,loadedQuery:this.state.loadedQuery})),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div",{className:"tab-content"},tabs)),sideBar)}}]);return DataQueryApp}(react__WEBPACK_IMPORTED_MODULE_0__["Component"]);DataQueryApp.propTypes={SavedQueries:prop_types__WEBPACK_IMPORTED_MODULE_1___default.a.array,AllSessions:prop_types__WEBPACK_IMPORTED_MODULE_1___default.a.array};DataQueryApp.defaultProps={SavedQueries:[],AllSessions:[]};window.SavedQueriesList=SavedQueriesList;window.DataQueryApp=DataQueryApp;window.RDataQueryApp=react__WEBPACK_IMPORTED_MODULE_0___default.a.createFactory(DataQueryApp);__webpack_exports__["default"]=DataQueryApp},3:function(module,exports,__webpack_require__){"use strict";
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var getOwnPropertySymbols=Object.getOwnPropertySymbols;var hasOwnProperty=Object.prototype.hasOwnProperty;var propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(val){if(val===null||val===undefined){throw new TypeError("Object.assign cannot be called with null or undefined")}return Object(val)}function shouldUseNative(){try{if(!Object.assign){return false}var test1=new String("abc");test1[5]="de";if(Object.getOwnPropertyNames(test1)[0]==="5"){return false}var test2={};for(var i=0;i<10;i++){test2["_"+String.fromCharCode(i)]=i}var order2=Object.getOwnPropertyNames(test2).map(function(n){return test2[n]});if(order2.join("")!=="0123456789"){return false}var test3={};"abcdefghijklmnopqrst".split("").forEach(function(letter){test3[letter]=letter});if(Object.keys(Object.assign({},test3)).join("")!=="abcdefghijklmnopqrst"){return false}return true}catch(err){return false}}module.exports=shouldUseNative()?Object.assign:function(target,source){var from;var to=toObject(target);var symbols;for(var s=1;s<arguments.length;s++){from=Object(arguments[s]);for(var key in from){if(hasOwnProperty.call(from,key)){to[key]=from[key]}}if(getOwnPropertySymbols){symbols=getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++){if(propIsEnumerable.call(from,symbols[i])){to[symbols[i]]=from[symbols[i]]}}}}return to}},4:function(module,exports,__webpack_require__){"use strict";var ReactPropTypesSecret=__webpack_require__(5);function emptyFunction(){}module.exports=function(){function shim(props,propName,componentName,location,propFullName,secret){if(secret===ReactPropTypesSecret){return}var err=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. "+"Use PropTypes.checkPropTypes() to call them. "+"Read more at http://fb.me/use-check-prop-types");err.name="Invariant Violation";throw err}shim.isRequired=shim;function getShim(){return shim}var ReactPropTypes={array:shim,bool:shim,func:shim,number:shim,object:shim,string:shim,symbol:shim,any:shim,arrayOf:getShim,element:shim,instanceOf:getShim,node:shim,objectOf:getShim,oneOf:getShim,oneOfType:getShim,shape:getShim,exact:getShim};ReactPropTypes.checkPropTypes=emptyFunction;ReactPropTypes.PropTypes=ReactPropTypes;return ReactPropTypes}},5:function(module,exports,__webpack_require__){"use strict";var ReactPropTypesSecret="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";module.exports=ReactPropTypesSecret}});
//# sourceMappingURL=react.app.js.map