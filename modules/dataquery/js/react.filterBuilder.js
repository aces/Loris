!function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:!1};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.loaded=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.p="",__webpack_require__(0)}([function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});/**
	 *  The following file contains the components used for the filter builder tab
	 *
	 *  @author   Jordan Stirling <jstirling91@gmail.com>
	 *  @license  http://www.gnu.org/licenses/gpl-3.0.txt GPLv3
	 *  @link     https://github.com/mohadesz/Loris-Trunk
	 */
var LogicOperator=React.createClass({displayName:"LogicOperator",changeOperator:function(op){this.props.updateGroupOperator(op)},render:function(){var andClass="btn",orClass="btn";return 1===this.props.logicOperator?(orClass+=" btn-primary",andClass+=" switch"):(andClass+=" btn-primary",orClass+=" switch"),React.createElement("div",{className:"btn-group",role:"group"},React.createElement("button",{type:"button",className:andClass,onClick:this.changeOperator.bind(this,0)},"And"),React.createElement("button",{type:"button",className:orClass,onClick:this.changeOperator.bind(this,1)},"Or"))}}),FilterRule=React.createClass({displayName:"FilterRule",getInitialState:function(){return{operators:{equal:"=",notEqual:"!=",lessThanEqual:"<=",greaterThanEqual:">=",startsWith:"startsWith",contains:"contains",isNull:"isNull",isNotNull:"isNotNull"},value:""}},componentWillMount:function(){this.valueSet=loris.debounce(this.valueSet,1e3)},selectInstrument:function(event){var rule=this.props.rule,that=this;event.target.value&&(rule.instrument=event.target.value,$.get(loris.BaseURL+"/AjaxHelper.php?Module=dataquery&script=datadictionary.php",{category:rule.instrument},function(data){rule.fields=data,that.props.updateRule(that.props.index,rule)},"json"))},fieldSelect:function(event){var rule=JSON.parse(JSON.stringify(this.props.rule));delete rule.field,delete rule.fieldType,delete rule.operator,delete rule.value,delete rule.visit,delete rule.candidates,event.target.value&&(rule.field=rule.fields[event.target.value].key[1],rule.fieldType=rule.fields[event.target.value].value.Type),this.props.updateRule(this.props.index,rule)},operatorSelect:function(event){var rule=JSON.parse(JSON.stringify(this.props.rule));delete rule.operator,delete rule.value,delete rule.visit,delete rule.candidates,event.target.value&&(rule.operator=event.target.value),this.props.updateRule(this.props.index,rule),"isNull"!==rule.operator&&"isNotNull"!==rule.operator||(this.setState({value:"null"}),this.valueSet())},valueChange:function(event){var rule=JSON.parse(JSON.stringify(this.props.rule));delete rule.visit,delete rule.candidates,rule.value=event.target.value,this.setState({value:event.target.value}),this.valueSet(),this.props.updateRule(this.props.index,rule)},valueSet:function(){var rule=JSON.parse(JSON.stringify(this.props.rule)),that=this;if(this.state.value){var responseHandler=function(data){var i,allSessions={},allCandiates={};for(i=0;i<data.length;i++)allSessions[data[i][1]]||(allSessions[data[i][1]]=[]),allSessions[data[i][1]].push(data[i][0]),allCandiates[data[i][0]]||(allCandiates[data[i][0]]=[]),allCandiates[data[i][0]].push(data[i][1]);rule.candidates={allCandiates:allCandiates,allSessions:allSessions},rule.session=Object.keys(allCandiates),rule.visit="All",that.props.updateSessions(that.props.index,rule)},ajaxRetrieve=function(script){$.get(loris.BaseURL+"/AjaxHelper.php?Module=dataquery&script="+script,{category:rule.instrument,field:rule.field,value:that.state.value},responseHandler,"json")};switch(rule.operator){case"equal":case"isNull":ajaxRetrieve("queryEqual.php");break;case"notEqual":case"isNotNull":ajaxRetrieve("queryNotEqual.php");break;case"lessThanEqual":ajaxRetrieve("queryLessThanEqual.php");break;case"greaterThanEqual":ajaxRetrieve("queryGreaterThanEqual.php");break;case"startsWith":ajaxRetrieve("queryStartsWith.php");break;case"contains":ajaxRetrieve("queryContains.php")}}},updateVisit:function(event){var rule=JSON.parse(JSON.stringify(this.props.rule));rule.visit=event.target.value,"all"===event.target.value?rule.session=Object.keys(rule.candidates.allCandiates):rule.session=rule.candidates.allSessions[event.target.value],this.props.updateSessions(this.props.index,rule)},render:function(){var rule,fieldIndex,forVisits,visits,that=this;if(this.props.rule.instrument){var inputOptions,input,operatorKey,operatorSelect,options,value,inputType,fields=this.props.rule.fields.map(function(field,index){return that.props.rule.field&&field.key[1]===that.props.rule.field&&(fieldIndex=index),React.createElement("option",{value:index},field.key[1])}),operators=[];if(this.props.rule.fieldType){inputType=this.props.rule.fieldType.split("("),operatorKey=inputType[0];for(var key in this.state.operators)operators.push(React.createElement("option",{value:key,onChange:this.operatorSelect},this.state.operators[key]));if(value=this.props.rule.operator?this.props.rule.operator:"",operatorSelect=React.createElement("select",{className:"input-sm col-xs-3 ",onChange:this.operatorSelect,value:value},React.createElement("option",{value:""}),operators),this.props.rule.operator&&"isNull"!==this.props.rule.operator&&"isNotNull"!==this.props.rule.operator)switch(operatorKey){case"enum":inputOptions=enumToArray(this.props.rule.fieldType),options=inputOptions.map(function(option){return React.createElement("option",{value:option},option)}),value=this.props.rule.value?this.props.rule.value:"",input=React.createElement("select",{className:"input-sm col-xs-3",onChange:this.valueChange,value:value},React.createElement("option",{value:""}),options);break;default:input=React.createElement("input",{type:"text",className:"input-sm col-xs-3",onChange:this.valueChange,value:this.props.rule.value})}this.props.rule.visit&&(visits=Object.keys(this.props.Visits).map(function(visit){return React.createElement("option",{value:visit},visit)}),forVisits=React.createElement("select",{className:"input-sm col-xs-3",onChange:this.updateVisit,value:this.props.rule.visit},React.createElement("option",{value:"all"},"All Visits"),visits))}rule=React.createElement("div",null,React.createElement("div",{className:"col-xs-12"},React.createElement("label",{className:"instrumentLabel"},this.props.rule.instrument)),React.createElement("div",{className:"col-xs-10"},React.createElement("select",{className:"input-sm col-xs-3",onChange:this.fieldSelect,value:fieldIndex},React.createElement("option",{value:""}),fields),operatorSelect,input,forVisits))}else{var options=this.props.items.map(function(item){return React.createElement("option",{value:item.category},item.category)});rule=React.createElement("select",{onChange:this.selectInstrument,className:"input-sm col-xs-10"},React.createElement("option",{value:""}),options)}return React.createElement("div",{className:"panel panel-default"},React.createElement("div",{className:"panel-body"},rule,React.createElement("div",{className:"col-xs-2"},React.createElement("button",{className:"btn btn-danger btn-sm pull-right",onClick:this.props.deleteRule.bind(this,this.props.index)},React.createElement("span",{className:"glyphicon glyphicon-remove"})," Delete"))))}}),FilterGroup=React.createClass({displayName:"FilterGroup",updateChild:function(index,child){var group=this.props.group;group.children[index]=child,this.props.index?this.props.updateGroup(this.props.index,group):this.props.updateFilter(group)},updateGroupOperator:function(operator){var group=this.props.group;group.activeOperator=operator,group.session=getSessions(group),this.props.index?this.props.updateGroup(this.props.index,group):this.props.updateFilter(group)},updateSessions:function(index,child){var group=this.props.group;group.children[index]=child,group.session=getSessions(group),this.props.index?this.props.updateSessions(this.props.index,group):this.props.updateFilter(group)},addChild:function(type){var child,group=this.props.group;child="rule"===type?{type:"rule"}:{type:"group",activeOperator:0,children:[{type:"rule"}]},group.children.push(child),this.props.index?this.props.updateGroup(this.props.index,group):this.props.updateFilter(group)},deleteChild:function(index){var group=this.props.group;group.children.splice(index,1),group.session=getSessions(group),this.props.index?this.props.updateGroup(this.props.index,group):this.props.updateFilter(group)},render:function(){var deleteButton,logicOperator=React.createElement(LogicOperator,{logicOperator:this.props.group.activeOperator,updateGroupOperator:this.updateGroupOperator}),that=this,children=this.props.group.children.map(function(child,index){return"rule"===child.type?React.createElement("li",null,React.createElement(FilterRule,{rule:child,items:that.props.items,index:index,updateRule:that.updateChild,updateSessions:that.updateSessions,deleteRule:that.deleteChild,Visits:that.props.Visits})):"group"===child.type?React.createElement("li",null,React.createElement(FilterGroup,{group:child,items:that.props.items,index:index,updateGroup:that.updateChild,updateSessions:that.updateSessions,deleteGroup:that.deleteChild,Visits:that.props.Visits})):void 0});return this.props.deleteGroup&&(deleteButton=React.createElement("button",{className:"btn btn-danger btn-sm pull-right",onClick:this.props.deleteGroup.bind(this,this.props.index)},React.createElement("span",{className:"glyphicon glyphicon-remove"})," Delete Group")),React.createElement("div",{className:"tree"},React.createElement("ul",{className:"firstUL"},React.createElement("li",null,React.createElement("div",{className:"row"},React.createElement("div",{className:"col-xs-2"},logicOperator),React.createElement("div",{className:"col-xs-10"},deleteButton,React.createElement("button",{className:"btn btn-primary btn-sm pull-right",onClick:this.addChild.bind(this,"group")},React.createElement("span",{className:"glyphicon glyphicon-add"})," Add Group"),React.createElement("button",{className:"btn btn-primary btn-sm pull-right",onClick:this.addChild.bind(this,"rule")},React.createElement("span",{className:"glyphicon glyphicon-add"})," Add Rule"))),React.createElement("ul",null,children))))}}),FilterBuilder=React.createClass({displayName:"FilterBuilder",render:function(){return React.createElement("div",null,React.createElement("h1",{className:"col-xs-12"},"Filter"),React.createElement("div",{className:"col-xs-12"},React.createElement("div",{className:"well well-primary"},React.createElement(FilterGroup,{group:this.props.filter,items:this.props.items,updateFilter:this.props.updateFilter,Visits:this.props.Visits}))))}});window.LogicOperator=LogicOperator,window.FilterRule=FilterRule,window.FilterGroup=FilterGroup,window.FilterBuilder=FilterBuilder,exports.default={LogicOperator:LogicOperator,FilterRule:FilterRule,FilterGroup:FilterGroup,FilterBuilder:FilterBuilder}}]);
//# sourceMappingURL=react.filterBuilder.js.map