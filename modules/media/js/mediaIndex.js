!function(e){function t(r){if(a[r])return a[r].exports;var n=a[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),o=a(3),u=r(o),c=a(4),d=r(c),m=function(e){function t(e){n(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return loris.hiddenHeaders=["Cand ID","Session ID"],a.state={isLoaded:!1,filter:{}},a.fetchData=a.fetchData.bind(a),a.updateFilter=a.updateFilter.bind(a),a}return s(t,e),l(t,[{key:"componentDidMount",value:function(){this.fetchData()}},{key:"fetchData",value:function(){$.ajax(this.props.DataURL,{method:"GET",dataType:"json",success:function(e){loris.hiddenHeaders=e.hiddenHeaders?e.hiddenHeaders:[],this.setState({Data:e,isLoaded:!0})}.bind(this),error:function(e){console.error(e)}})}},{key:"updateFilter",value:function(e){this.setState({filter:e})}},{key:"render",value:function(){if(!this.state.isLoaded)return React.createElement("button",{className:"btn-info has-spinner"},"Loading",React.createElement("span",{className:"glyphicon glyphicon-refresh glyphicon-refresh-animate"}));var e=[{id:"browse",label:"Browse"},{id:"upload",label:"Upload"}];return React.createElement(Tabs,{tabs:e,defaultTab:"browse"},React.createElement(TabPane,{TabId:e[0].id},React.createElement(FilterForm,{Module:"media",name:"media_filter",id:"media_filter",columns:2,formElements:this.state.Data.form,onUpdate:this.updateFilter,filter:this.state.filter}),React.createElement(StaticDataTable,{Data:this.state.Data.Data,Headers:this.state.Data.Headers,Filter:this.state.filter,getFormattedCell:d.default,freezeColumn:"File Name"})),React.createElement(TabPane,{TabId:e[1].id},React.createElement(u.default,{DataURL:loris.BaseURL+"/media/ajax/FileUpload.php?action=getData",action:loris.BaseURL+"/media/ajax/FileUpload.php?action=upload"})))}}]),t}(React.Component);$(function(){ReactDOM.render(React.createElement(m,{DataURL:loris.BaseURL+"/media/?format=json"}),document.getElementById("page-wrapper"))})},,,function(e,t){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),s=function(e){function t(e){a(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={Data:{},formData:{},uploadResult:null,errorMessage:null,isLoaded:!1,loadedData:0},n.getValidFileName=n.getValidFileName.bind(n),n.handleSubmit=n.handleSubmit.bind(n),n.isValidFileName=n.isValidFileName.bind(n),n.isValidForm=n.isValidForm.bind(n),n.setFormData=n.setFormData.bind(n),n.showAlertMessage=n.showAlertMessage.bind(n),n}return n(t,e),i(t,[{key:"componentDidMount",value:function(){var e=this;$.ajax(this.props.DataURL,{dataType:"json",success:function(t){e.setState({Data:t,isLoaded:!0})},error:function(t,a,r){console.error(t,a,r),e.setState({error:"An error occurred when loading the form!"})}})}},{key:"render",value:function(){if(void 0!==this.state.error)return React.createElement("div",{className:"alert alert-danger text-center"},React.createElement("strong",null,this.state.error));if(!this.state.isLoaded)return React.createElement("button",{className:"btn-info has-spinner"},"Loading",React.createElement("span",{className:"glyphicon glyphicon-refresh glyphicon-refresh-animate"}));var e=["File name should begin with ",React.createElement("b",null,"[PSCID]_[Visit Label]_[Instrument]"),React.createElement("br",null)," For example, for candidate ",React.createElement("i",null,"ABC123"),", visit ",React.createElement("i",null,"V1")," for ",React.createElement("i",null,"Body Mass Index")," the file name should be prefixed by: ",React.createElement("b",null,"ABC123_V1_Body_Mass_Index")],t="",a="alert text-center hide";if(this.state.uploadResult)if("success"===this.state.uploadResult)a="alert alert-success text-center",t="Upload Successful!";else if("error"===this.state.uploadResult){var r=this.state.errorMessage;a="alert alert-danger text-center",t=r?r:"Failed to upload!"}return React.createElement("div",null,React.createElement("div",{className:a,role:"alert",ref:"alert-message"},t),React.createElement(FormElement,{name:"mediaUpload",fileUpload:!0,onSubmit:this.handleSubmit,ref:"form"},React.createElement("h3",null,"Upload a media file"),React.createElement("br",null),React.createElement(StaticElement,{label:"Note",text:e}),React.createElement(SelectElement,{name:"pscid",label:"PSCID",options:this.state.Data.candidates,onUserInput:this.setFormData,ref:"pscid",hasError:!1,required:!0,value:this.state.formData.pscid}),React.createElement(SelectElement,{name:"visitLabel",label:"Visit Label",options:this.state.Data.visits,onUserInput:this.setFormData,ref:"visitLabel",required:!0,value:this.state.formData.visitLabel}),React.createElement(SelectElement,{name:"forSite",label:"Site",options:this.state.Data.sites,onUserInput:this.setFormData,ref:"forSite",required:!0,value:this.state.formData.forSite}),React.createElement(SelectElement,{name:"instrument",label:"Instrument",options:this.state.Data.instruments,onUserInput:this.setFormData,ref:"instrument",value:this.state.formData.instrument}),React.createElement(DateElement,{name:"dateTaken",label:"Date of Administration",minYear:"2000",maxYear:"2017",onUserInput:this.setFormData,ref:"dateTaken",value:this.state.formData.dateTaken}),React.createElement(TextareaElement,{name:"comments",label:"Comments",onUserInput:this.setFormData,ref:"comments",value:this.state.formData.comments}),React.createElement(FileElement,{name:"file",id:"mediaUploadEl",onUserInput:this.setFormData,ref:"file",label:"File to upload",required:!0,value:this.state.formData.file}),React.createElement(ButtonElement,{label:"Upload File"})))}},{key:"getValidFileName",value:function(e,t,a){var r=e+"_"+t;return a&&(r+="_"+a),r}},{key:"handleSubmit",value:function(e){e.preventDefault();var t=this.state.formData,a=this.refs,r=this.state.Data.mediaFiles?this.state.Data.mediaFiles:[];if(this.isValidForm(a,t)){var n=t.instrument?t.instrument:null,i=t.file?t.file.name:null,s=this.getValidFileName(t.pscid,t.visitLabel,n);if(!this.isValidFileName(s,i))return void alert("File name should begin with: "+s);var l=r.indexOf(t.file.name);if(l>=0){var o=confirm("A file with this name already exists!\nWould you like to override existing file?");if(!o)return}var u=this,c=new FormData;for(var d in t)""!==t[d]&&c.append(d,t[d]);$("#mediaUploadEl").hide(),$("#file-progress").removeClass("hide"),$.ajax({type:"POST",url:u.props.action,data:c,cache:!1,contentType:!1,processData:!1,xhr:function e(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=$("#progressbar"),a=$("#progresslabel"),r=Math.round(e.loaded/e.total*100);$(t).width(r+"%"),$(a).html(r+"%"),t.attr("aria-valuenow",r)}},!1),e},success:function(e){$("#file-progress").addClass("hide");var r=u.state.Data.mediaFiles;r.push(t.file.name),u.setState({mediaFiles:r,uploadResult:"success",formData:{}});var n=new CustomEvent("update-datatable");window.dispatchEvent(n),u.showAlertMessage(),Object.keys(a).map(function(e){a[e].state&&a[e].state.value&&(a[e].state.value="")}),u.forceUpdate()},error:function(e){console.error(e);var t=e.responseJSON?e.responseJSON.message:"Upload error!";u.setState({uploadResult:"error",errorMessage:t}),u.showAlertMessage()}})}}},{key:"isValidFileName",value:function(e,t){return null!==t&&null!==e&&0===t.indexOf(e)}},{key:"isValidForm",value:function e(t,a){var e=!0,r={pscid:null,visitLabel:null,file:null};return Object.keys(r).map(function(n){a[n]?r[n]=a[n]:t[n]&&(t[n].props.hasError=!0,e=!1)}),this.forceUpdate(),e}},{key:"setFormData",value:function(e,t){var a=this.state.formData.visitLabel,r=this.state.formData.pscid;"pscid"===e&&""!==t&&(this.state.Data.visits=this.state.Data.sessionData[t].visits,this.state.Data.sites=this.state.Data.sessionData[t].sites,a?this.state.Data.instruments=this.state.Data.sessionData[t].instruments[a]:this.state.Data.instruments=this.state.Data.sessionData[t].instruments.all),"visitLabel"===e&&""!==t&&r&&(this.state.Data.instruments=this.state.Data.sessionData[r].instruments[t]);var n=this.state.formData;n[e]=t,this.setState({formData:n})}},{key:"showAlertMessage",value:function(){var e=this;if(null!==this.refs["alert-message"]){var t=this.refs["alert-message"];$(t).fadeTo(2e3,500).delay(3e3).slideUp(500,function(){e.setState({uploadResult:null})})}}}]),t}(React.Component);s.propTypes={DataURL:React.PropTypes.string.isRequired,action:React.PropTypes.string.isRequired};var l=React.createFactory(s);window.MediaUploadForm=s,window.RMediaUploadForm=l,t.default=s},function(e,t){"use strict";function a(e,t,a,r){if(loris.hiddenHeaders.indexOf(e)>-1)return null;var n={};r.forEach(function(e,t){n[e]=a[t]},this);var i=loris.userHasPermission("media_write");if("File Name"===e&&i===!0){var s=loris.BaseURL+"/media/ajax/FileDownload.php?File="+n["File Name"];return React.createElement("td",null,React.createElement("a",{href:s,target:"_blank",download:n["File Name"]},t))}if("Visit Label"===e&&null!==n["Cand ID"]&&n["Session ID"]){var l=loris.BaseURL+"/instrument_list/?candID="+n["Cand ID"]+"&sessionID="+n["Session ID"];return React.createElement("td",null,React.createElement("a",{href:l},t))}if("Edit Metadata"===e){var o=loris.BaseURL+"/media/edit/?id="+n["Edit Metadata"];return React.createElement("td",null,React.createElement("a",{href:o},"Edit"))}return React.createElement("td",null,t)}Object.defineProperty(t,"__esModule",{value:!0}),window.formatColumn=a,t.default=a}]);
//# sourceMappingURL=mediaIndex.js.map