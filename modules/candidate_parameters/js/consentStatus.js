!function(t){function e(s){if(a[s])return a[s].exports;var r=a[s]={exports:{},id:s,loaded:!1};return t[s].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var a={};return e.m=t,e.c=a,e.p="",e(0)}([function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=React.createClass({displayName:"ConsentStatus",getInitialState:function(){return{consentOptions:{yes:"Yes",no:"No"},Data:[],formData:{},updateResult:null,errorMessage:null,isLoaded:!1,loadedData:0}},componentDidMount:function(){var t=this;$.ajax(this.props.dataURL,{dataType:"json",xhr:function e(){var e=new window.XMLHttpRequest;return e.addEventListener("progress",function(e){t.setState({loadedData:e.loaded})}),e},success:function(e){var a={},s=e.consents;for(var r in s)if(s.hasOwnProperty(r)){var n=r+"_date",o=r+"_date2",i=r+"_withdrawal",l=r+"_withdrawal2";a[r]=e.consentStatuses[r],a[n]=e.consentDates[r],a[o]=e.consentDates[r],a[i]=e.withdrawals[r],a[l]=e.withdrawals[r]}t.setState({Data:e,formData:a,isLoaded:!0})},error:function(e,a,s){t.setState({error:"An error occurred when loading the form!"})}})},setFormData:function(t,e){var a=this.state.formData;a[t]=e,this.setState({formData:a})},onSubmit:function(t){t.preventDefault()},render:function(){if(!this.state.isLoaded)return void 0!==this.state.error?React.createElement("div",{className:"alert alert-danger text-center"},React.createElement("strong",null,this.state.error)):React.createElement("button",{className:"btn-info has-spinner"},"Loading",React.createElement("span",{className:"glyphicon glyphicon-refresh glyphicon-refresh-animate"}));var t=!0,e=null;loris.userHasPermission("candidate_parameter_edit")&&(t=!1,e=React.createElement(ButtonElement,{label:"Update"}));var a=[],s=[],r=0;for(var n in this.state.Data.consents)if(this.state.Data.consents.hasOwnProperty(n)){var o=n+"_withdrawal";"yes"===this.state.formData[n]&&(a[r]=!0),this.state.formData[o]?s[r]=!0:s[r]=!1,r++}var i=[];r=0;for(var l in this.state.Data.consents)if(this.state.Data.consents.hasOwnProperty(l)){var c=this.state.Data.consents[l],d=l+"_date",h=l+"_date2",u="Date of "+c,f="Confirmation Date of "+c,p=l+"_withdrawal",m=l+"_withdrawal2",D="Date of Withdrawal of "+c,w="Confirmation Date of Withdrawal of "+c;i.push(React.createElement(SelectElement,{label:c,name:l,options:this.state.consentOptions,value:this.state.Data.consentStatuses[l],onUserInput:this.setFormData,ref:l,disabled:t,required:!1})),i.push(React.createElement(DateElement,{label:u,name:d,value:this.state.Data.consentDates[l],onUserInput:this.setFormData,ref:d,disabled:t,required:a[r]})),i.push(React.createElement(DateElement,{label:f,name:h,value:this.state.Data.consentDates[l],onUserInput:this.setFormData,ref:h,disabled:t,required:a[r]})),i.push(React.createElement(DateElement,{label:D,name:p,value:this.state.Data.withdrawals[l],onUserInput:this.setFormData,ref:p,disabled:t,required:!1})),i.push(React.createElement(DateElement,{label:w,name:m,value:this.state.Data.withdrawals[l],onUserInput:this.setFormData,ref:m,disabled:t,required:s[r]})),i.push(React.createElement("hr",null)),r++}var v=[];for(var y in this.state.Data.history)if(this.state.Data.history.hasOwnProperty(y)){var b=this.state.Data.history[y].label,R=this.state.Data.history[y].consentType;for(var E in this.state.Data.history[y])if(this.state.Data.history[y].hasOwnProperty(E)){var S="",g=this.state.Data.history[y][E];for(var _ in g)if(g.hasOwnProperty(_)){var x=g[_];if(null!==x)switch(_){case"data_entry_date":S+="[",S+=x,S+="] ";break;case"entry_staff":S+=x,S+=" ";break;case R:S+=b+" Status: ",S+=x,S+=" ";break;case R+"_date":S+="Date of Consent: ",S+=x,S+=" ";break;case R+"_withdrawal":S+="Date of Consent Withdrawal: ",S+=x,S+=" "}}v.push(React.createElement("p",null,S))}}var O="",C="alert text-center hide";if(this.state.updateResult)if("success"===this.state.updateResult)C="alert alert-success text-center",O="Update Successful!";else if("error"===this.state.updateResult){var F=this.state.errorMessage;C="alert alert-danger text-center",O=F?F:"Failed to update!"}return React.createElement("div",{class:"row"},React.createElement("div",{className:C,role:"alert",ref:"alert-message"},O),React.createElement(FormElement,{name:"consentStatus",onSubmit:this.handleSubmit,ref:"form",class:"col-md-6"},React.createElement(StaticElement,{label:"PSCID",text:this.state.Data.pscid}),React.createElement(StaticElement,{label:"DCCID",text:this.state.Data.candID}),i,e,v))},handleSubmit:function(t){t.preventDefault();var e=this.state.formData,a=new Date,s=a.getDate(),r=a.getMonth()+1,n=a.getFullYear();s<10&&(s="0"+s),r<10&&(r="0"+r),a=n+"-"+r+"-"+s;for(var o in this.state.Data.consents)if(this.state.Data.consents.hasOwnProperty(o)){var i=this.state.Data.consents[o],l=o+"_date",c=o+"_date2",d=e[l]?e[l]:null,h=e[c]?e[c]:null;if(d!==h)return void alert(i+" dates do not match!");if(d>a)return void alert(i+" date cannot be later than today!");var u=o+"_withdrawal",f=o+"_withdrawal2";if(d=e[u]?e[u]:null,h=e[f]?e[f]:null,d!==h)return void alert(i+" withdrawal dates do not match!");if(d>a)return void alert(i+" withdrawal date cannot be later than today!")}var p=this,m=new FormData;for(var D in e)""!==e[D]&&m.append(D,e[D]);m.append("tab",this.props.tabName),m.append("candID",this.state.Data.candID),$.ajax({type:"POST",url:p.props.action,data:m,cache:!1,contentType:!1,processData:!1,success:function(t){p.setState({updateResult:"success"}),p.showAlertMessage()},error:function(t){if(""!==t.responseText){var e=JSON.parse(t.responseText).message;p.setState({updateResult:"error",errorMessage:e}),p.showAlertMessage()}}})},showAlertMessage:function(){var t=this;if(null!==this.refs["alert-message"]){var e=this.refs["alert-message"];$(e).fadeTo(2e3,500).delay(3e3).slideUp(500,function(){t.setState({updateResult:null})})}}}),s=React.createFactory(a);window.ConsentStatus=a,window.RConsentStatus=s,e.default=a}]);
//# sourceMappingURL=consentStatus.js.map