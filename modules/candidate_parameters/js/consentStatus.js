!function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:!1};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.loaded=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.p="",__webpack_require__(0)}([function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ConsentStatus=React.createClass({displayName:"ConsentStatus",getInitialState:function(){return{consentOptions:{yes:"Yes",no:"No"},Data:[],formData:{},updateResult:null,errorMessage:null,isLoaded:!1,loadedData:0}},componentDidMount:function(){var that=this;$.ajax(this.props.dataURL,{dataType:"json",xhr:function xhr(){var xhr=new window.XMLHttpRequest;return xhr.addEventListener("progress",function(evt){that.setState({loadedData:evt.loaded})}),xhr},success:function(data){var formData={},consents=data.consents;for(var consentStatus in consents)if(consents.hasOwnProperty(consentStatus)){var consentDate=consentStatus+"_date",consentDate2=consentStatus+"_date2",consentWithdrawal=consentStatus+"_withdrawal",consentWithdrawal2=consentStatus+"_withdrawal2";formData[consentStatus]=data.consentStatuses[consentStatus],formData[consentDate]=data.consentDates[consentStatus],formData[consentDate2]=data.consentDates[consentStatus],formData[consentWithdrawal]=data.withdrawals[consentStatus],formData[consentWithdrawal2]=data.withdrawals[consentStatus]}that.setState({Data:data,formData:formData,isLoaded:!0})},error:function(data,errorCode,errorMsg){that.setState({error:"An error occurred when loading the form!"})}})},setFormData:function(formElement,value){var formData=this.state.formData;formData[formElement]=value,this.setState({formData:formData})},onSubmit:function(e){e.preventDefault()},render:function(){if(!this.state.isLoaded)return void 0!==this.state.error?React.createElement("div",{className:"alert alert-danger text-center"},React.createElement("strong",null,this.state.error)):React.createElement("button",{className:"btn-info has-spinner"},"Loading",React.createElement("span",{className:"glyphicon glyphicon-refresh glyphicon-refresh-animate"}));var disabled=!0,updateButton=null;loris.userHasPermission("candidate_parameter_edit")&&(disabled=!1,updateButton=React.createElement(ButtonElement,{label:"Update"}));var dateRequired=[],withdrawalRequired=[],i=0;for(var consent in this.state.Data.consents)if(this.state.Data.consents.hasOwnProperty(consent)){var withdrawal=consent+"_withdrawal";"yes"===this.state.formData[consent]&&(dateRequired[i]=!0),this.state.formData[withdrawal]?withdrawalRequired[i]=!0:withdrawalRequired[i]=!1,i++}var consents=[];i=0;for(var consentStatus in this.state.Data.consents)if(this.state.Data.consents.hasOwnProperty(consentStatus)){var label=this.state.Data.consents[consentStatus],consentDate=consentStatus+"_date",consentDate2=consentStatus+"_date2",consentDateLabel="Date of "+label,consentDateConfirmationLabel="Confirmation Date of "+label,consentWithdrawal=consentStatus+"_withdrawal",consentWithdrawal2=consentStatus+"_withdrawal2",consentWithdrawalLabel="Date of Withdrawal of "+label,consentWithdrawalConfirmationLabel="Confirmation Date of Withdrawal of "+label;consents.push(React.createElement(SelectElement,{label:label,name:consentStatus,options:this.state.consentOptions,value:this.state.Data.consentStatuses[consentStatus],onUserInput:this.setFormData,ref:consentStatus,disabled:disabled,required:!1})),consents.push(React.createElement(DateElement,{label:consentDateLabel,name:consentDate,value:this.state.Data.consentDates[consentStatus],onUserInput:this.setFormData,ref:consentDate,disabled:disabled,required:dateRequired[i]})),consents.push(React.createElement(DateElement,{label:consentDateConfirmationLabel,name:consentDate2,value:this.state.Data.consentDates[consentStatus],onUserInput:this.setFormData,ref:consentDate2,disabled:disabled,required:dateRequired[i]})),consents.push(React.createElement(DateElement,{label:consentWithdrawalLabel,name:consentWithdrawal,value:this.state.Data.withdrawals[consentStatus],onUserInput:this.setFormData,ref:consentWithdrawal,disabled:disabled,required:!1})),consents.push(React.createElement(DateElement,{label:consentWithdrawalConfirmationLabel,name:consentWithdrawal2,value:this.state.Data.withdrawals[consentStatus],onUserInput:this.setFormData,ref:consentWithdrawal2,disabled:disabled,required:withdrawalRequired[i]})),consents.push(React.createElement("hr",null)),i++}var formattedHistory=[];for(var consentKey in this.state.Data.history)if(this.state.Data.history.hasOwnProperty(consentKey)){var consentLabel=this.state.Data.history[consentKey].label,consentType=this.state.Data.history[consentKey].consentType;for(var field in this.state.Data.history[consentKey])if(this.state.Data.history[consentKey].hasOwnProperty(field)){var line="",historyConsent=this.state.Data.history[consentKey][field];for(var field2 in historyConsent)if(historyConsent.hasOwnProperty(field2)){var current=historyConsent[field2];if(null!==current)switch(field2){case"data_entry_date":line+="[",line+=current,line+="] ";break;case"entry_staff":line+=current,line+=" ";break;case consentType:line+=consentLabel+" Status: ",line+=current,line+=" ";break;case consentType+"_date":line+="Date of Consent: ",line+=current,line+=" ";break;case consentType+"_withdrawal":line+="Date of Consent Withdrawal: ",line+=current,line+=" "}}formattedHistory.push(React.createElement("p",null,line))}}var alertMessage="",alertClass="alert text-center hide";if(this.state.updateResult)if("success"===this.state.updateResult)alertClass="alert alert-success text-center",alertMessage="Update Successful!";else if("error"===this.state.updateResult){var errorMessage=this.state.errorMessage;alertClass="alert alert-danger text-center",alertMessage=errorMessage?errorMessage:"Failed to update!"}return React.createElement("div",{class:"row"},React.createElement("div",{className:alertClass,role:"alert",ref:"alert-message"},alertMessage),React.createElement(FormElement,{name:"consentStatus",onSubmit:this.handleSubmit,ref:"form",class:"col-md-6"},React.createElement(StaticElement,{label:"PSCID",text:this.state.Data.pscid}),React.createElement(StaticElement,{label:"DCCID",text:this.state.Data.candID}),consents,updateButton,formattedHistory))},handleSubmit:function(e){e.preventDefault();var myFormData=this.state.formData,today=new Date,dd=today.getDate(),mm=today.getMonth()+1,yyyy=today.getFullYear();dd<10&&(dd="0"+dd),mm<10&&(mm="0"+mm),today=yyyy+"-"+mm+"-"+dd;for(var consentStatus in this.state.Data.consents)if(this.state.Data.consents.hasOwnProperty(consentStatus)){var label=this.state.Data.consents[consentStatus],consentDate=consentStatus+"_date",consentDate2=consentStatus+"_date2",date1=myFormData[consentDate]?myFormData[consentDate]:null,date2=myFormData[consentDate2]?myFormData[consentDate2]:null;if(date1!==date2)return void alert(label+" dates do not match!");if(date1>today)return void alert(label+" date cannot be later than today!");var consentWithdrawal=consentStatus+"_withdrawal",consentWithdrawal2=consentStatus+"_withdrawal2";if(date1=myFormData[consentWithdrawal]?myFormData[consentWithdrawal]:null,date2=myFormData[consentWithdrawal2]?myFormData[consentWithdrawal2]:null,date1!==date2)return void alert(label+" withdrawal dates do not match!");if(date1>today)return void alert(label+" withdrawal date cannot be later than today!")}var self=this,formData=new FormData;for(var key in myFormData)""!==myFormData[key]&&formData.append(key,myFormData[key]);formData.append("tab",this.props.tabName),formData.append("candID",this.state.Data.candID),$.ajax({type:"POST",url:self.props.action,data:formData,cache:!1,contentType:!1,processData:!1,success:function(data){self.setState({updateResult:"success"}),self.showAlertMessage()},error:function(err){if(""!==err.responseText){var errorMessage=JSON.parse(err.responseText).message;self.setState({updateResult:"error",errorMessage:errorMessage}),self.showAlertMessage()}}})},showAlertMessage:function(){var self=this;if(null!==this.refs["alert-message"]){var alertMsg=this.refs["alert-message"];$(alertMsg).fadeTo(2e3,500).delay(3e3).slideUp(500,function(){self.setState({updateResult:null})})}}}),RConsentStatus=React.createFactory(ConsentStatus);window.ConsentStatus=ConsentStatus,window.RConsentStatus=RConsentStatus,exports.default=ConsentStatus}]);
//# sourceMappingURL=consentStatus.js.map