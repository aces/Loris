!function(t){function e(s){if(a[s])return a[s].exports;var r=a[s]={exports:{},id:s,loaded:!1};return t[s].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var a={};return e.m=t,e.c=a,e.p="",e(0)}([function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=React.createClass({displayName:"MonitoringStatus",getInitialState:function(){return{flaggedOptions:{yes:"Yes",no:"No"},monitoredOptions:{Y:"Yes",N:"No"},Data:[],formData:{},updateResult:null,errorMessage:null,isLoaded:!1,loadedData:0}},componentDidMount:function(){var t=this;$.ajax(this.props.dataURL,{dataType:"json",xhr:function e(){var e=new window.XMLHttpRequest;return e.addEventListener("progress",function(e){t.setState({loadedData:e.loaded})}),e},success:function(e){var a={},s=e.visits;for(var r in s)if(s.hasOwnProperty(r)){var n=r+"_monitored",i=r+"_date",o=r+"_date2",l=r+"_monitor";a[n]=e.monitored[r],a[r]=e.flagged[r],a[i]=e.dateMonitored[r],a[o]=e.dateMonitored[r],a[l]=e.monitorID[r]}t.setState({Data:e,formData:a,isLoaded:!0})},error:function(e,a,s){t.setState({error:"An error occurred when loading the form!"})}})},setFormData:function(t,e){var a=this.state.formData;a[t]=e,this.setState({formData:a})},onSubmit:function(t){t.preventDefault()},render:function(){if(!this.state.isLoaded)return void 0!==this.state.error?React.createElement("div",{className:"alert alert-danger text-center"},React.createElement("strong",null,this.state.error)):React.createElement("button",{className:"btn-info has-spinner"},"Loading",React.createElement("span",{className:"glyphicon glyphicon-refresh glyphicon-refresh-animate"}));var t=!0,e=null;loris.userHasPermission("candidate_parameter_edit")&&(t=!1,e=React.createElement(ButtonElement,{label:"Update"}));var a=[],s=[],r=[],n=0;for(var i in this.state.Data.visits)this.state.Data.visits.hasOwnProperty(i)&&("yes"===this.state.formData[i]?r[n]=!0:a[n]=!0,"Y"===this.state.formData[i+"_monitored"]&&(s[n]=!0),n++);var o=[];n=0;for(var l in this.state.Data.visits)if(this.state.Data.visits.hasOwnProperty(l)){var c=this.state.Data.visits[l],d=l+"_monitored",u=" Monitored: ",m=l+"_date",h="Date Monitored: ",p=l+"_date2",f="Confirm Date Monitored: ",D=l+"_monitor",v="Monitored By (Examiner): ";o.push(React.createElement(SelectElement,{label:c,name:l,options:this.state.flaggedOptions,value:this.state.formData[l],onUserInput:this.setFormData,ref:l,disabled:t,required:!0})),o.push(React.createElement(SelectElement,{label:u,name:d,options:this.state.monitoredOptions,value:this.state.formData[d],onUserInput:this.setFormData,ref:d,disabled:a[n]||t,required:r[n]})),o.push(React.createElement(DateElement,{label:h,name:m,value:this.state.formData[m],onUserInput:this.setFormData,ref:m,disabled:a[n]||t,required:s[n]})),o.push(React.createElement(DateElement,{label:f,name:p,value:this.state.formData[p],onUserInput:this.setFormData,ref:p,disabled:a[n]||t,required:s[n]})),o.push(React.createElement(SelectElement,{label:v,name:D,options:this.state.Data.examiners,value:this.state.formData[D],onUserInput:this.setFormData,ref:D,disabled:a[n]||t,required:s[n]})),o.push(React.createElement("hr",null)),n++}var E=[];for(var R in this.state.Data.history)if(this.state.Data.history.hasOwnProperty(R)){var g=[],b="",y=this.state.Data.history[R],S=y.entry_staff,M=y.data_entry_date,_=y.visit_label,w=y.flag,x=y.monitored,F=y.date_monitored,I=y.monitor_id;b+="[UPDATE by ",b+=S,b+=" at ",b+=M,b+="]",g.push(React.createElement("td",null,React.createElement("b",null,"Visit->"),_)),g.push(React.createElement("td",{class:"td-hist"},React.createElement("b",null,"Flagged ->"),w)),g.push(React.createElement("td",{class:"td-hist"},React.createElement("b",null,"Monitored ->"),x)),null!==F&&g.push(React.createElement("td",{class:"td-hist"},React.createElement("b",null,"Date Monitored ->"),F)),null!==I&&g.push(React.createElement("td",{class:"td-hist"},React.createElement("b",null,"Monitored by ->"),this.state.Data.examiners[I])),E.push(React.createElement("tr",null,React.createElement("td",{style:{padding:"1px",width:"25%"}},React.createElement("i",null,b)),g))}var O="",N="alert text-center hide";if(this.state.updateResult)if("success"===this.state.updateResult)N="alert alert-success text-center",O="Update Successful!";else if("error"===this.state.updateResult){var P=this.state.errorMessage;N="alert alert-danger text-center",O=P?P:"Failed to update!"}return React.createElement("div",{class:"row"},React.createElement("div",{className:N,role:"alert",ref:"alert-message"},O),React.createElement(FormElement,{name:"monitoringStatus",onSubmit:this.handleSubmit,ref:"form",class:"col-md-12"},React.createElement(StaticElement,{label:"PSCID",text:this.state.Data.pscid}),React.createElement(StaticElement,{label:"DCCID",text:this.state.Data.candID}),o,e,React.createElement("table",{className:"table-hist"},E)))},handleSubmit:function(t){t.preventDefault();var e=this.state.formData,a=new Date,s=a.getDate(),r=a.getMonth()+1,n=a.getFullYear();s<10&&(s="0"+s),r<10&&(r="0"+r),a=n+"-"+r+"-"+s;for(var i in this.state.Data.visits)if(this.state.Data.visits.hasOwnProperty(i)){var o=this.state.Data.visits[i],l=i+"_date",c=i+"_date2",d=e[l]?e[l]:null,u=e[c]?e[c]:null;if(d!==u)return void alert(o+" dates do not match!");if(d>a)return void alert(o+" date cannot be later than today!")}var m=this,h=new FormData;for(var p in e)""!==e[p]&&h.append(p,e[p]);h.append("tab",this.props.tabName),h.append("candID",this.state.Data.candID),$.ajax({type:"POST",url:m.props.action,data:h,cache:!1,contentType:!1,processData:!1,success:function(t){m.setState({updateResult:"success"}),m.showAlertMessage()},error:function(t){if(""!==t.responseText){var e=JSON.parse(t.responseText).message;m.setState({updateResult:"error",errorMessage:e}),m.showAlertMessage()}}})},showAlertMessage:function(){var t=this;if(null!==this.refs["alert-message"]){var e=this.refs["alert-message"];$(e).fadeTo(2e3,500).delay(3e3).slideUp(500,function(){t.setState({updateResult:null})})}}}),s=React.createFactory(a);window.MonitoringStatus=a,window.RMonitoringStatus=s,e.default=a}]);
//# sourceMappingURL=monitoring.js.map