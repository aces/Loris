!function(e){function t(s){if(a[s])return a[s].exports;var r=a[s]={exports:{},id:s,loaded:!1};return e[s].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=React.createClass({displayName:"FamilyInfo",getInitialState:function(){return{Data:[],formData:{},familyMembers:[],updateResult:null,errorMessage:null,isLoaded:!1,loadedData:0}},componentDidMount:function(){var e=this;$.ajax(this.props.dataURL,{dataType:"json",xhr:function t(){var t=new window.XMLHttpRequest;return t.addEventListener("progress",function(t){e.setState({loadedData:t.loaded})}),t},success:function(t){e.setState({Data:t,isLoaded:!0,familyMembers:t.existingFamilyMembers})},error:function(t,a,s){e.setState({error:"An error occurred when loading the form!"})}})},setFormData:function(e,t){var a=this.state.formData;a[e]=t,this.setState({formData:a})},onSubmit:function(e){e.preventDefault()},render:function(){if(!this.state.isLoaded)return void 0!==this.state.error?React.createElement("div",{className:"alert alert-danger text-center"},React.createElement("strong",null,this.state.error)):React.createElement("button",{className:"btn-info has-spinner"},"Loading",React.createElement("span",{className:"glyphicon glyphicon-refresh glyphicon-refresh-animate"}));var e={full_sibling:"Full Sibling",half_sibling:"Half Sibling","1st_cousin":"First Cousin"},t=!0,a=null;loris.userHasPermission("candidate_parameter_edit")&&(t=!1,a=React.createElement(ButtonElement,{label:"Add"}));var s=this.state.Data.candidates,r=this.state.familyMembers,n=[];for(var l in r)if(r.hasOwnProperty(l)){var i=r[l].FamilyCandID,o=r[l].Relationship_type,c="?candID="+i+"&identifier="+i;n.push(React.createElement("div",null,React.createElement(StaticElement,{label:"Family Member DCCID",text:React.createElement("a",{href:c},i)}),React.createElement(StaticElement,{label:"Relation Type",text:e[o]}),React.createElement(ButtonElement,{label:"Delete",type:"button",onUserInput:this.deleteFamilyMember.bind(null,i,l,s)}),React.createElement("hr",null))),delete s[i]}var m=!1;this.state.formData.FamilyCandID&&(m=!0);var d="",u="alert text-center hide";if(this.state.updateResult)if("success"===this.state.updateResult)u="alert alert-success text-center",d="Update Successful!";else if("error"===this.state.updateResult){var p=this.state.errorMessage;u="alert alert-danger text-center",d=p?p:"Failed to update!"}return React.createElement("div",{className:"row"},React.createElement("div",{className:u,role:"alert",ref:"alert-message"},d),React.createElement(FormElement,{name:"familyInfo",onSubmit:this.handleSubmit,ref:"form",class:"col-md-6"},React.createElement(StaticElement,{label:"PSCID",text:this.state.Data.pscid}),React.createElement(StaticElement,{label:"DCCID",text:this.state.Data.candID}),React.createElement("hr",null),n,React.createElement(SelectElement,{label:"Family Member ID (DCCID)",name:"FamilyCandID",options:s,onUserInput:this.setFormData,ref:"FamilyCandID",disabled:t,required:!1,value:this.state.formData.FamilyCandID}),React.createElement(SelectElement,{label:"Relation Type",name:"Relationship_type",options:e,onUserInput:this.setFormData,ref:"Relationship_type",disabled:t,required:m,value:this.state.formData.Relationship_type}),a))},handleSubmit:function(e){e.preventDefault();var t=this.state.formData,a=this,s=new FormData,r=this.refs,n=this.state.familyMembers,l={};for(var i in t)t.hasOwnProperty(i)&&""!==t[i]&&(l[i]=t[i],s.append(i,t[i]));s.append("tab",this.props.tabName),s.append("candID",this.state.Data.candID),n.push(l),this.setState({familyMembers:n}),$.ajax({type:"POST",url:a.props.action,data:s,cache:!1,contentType:!1,processData:!1,success:function(e){a.setState({updateResult:"success",formData:{}}),a.showAlertMessage(),Object.keys(r).map(function(e){r[e].state&&r[e].state.value&&(r[e].state.value="")}),a.forceUpdate()},error:function(e){var t=JSON.parse(e.responseText).message;a.setState({updateResult:"error",errorMessage:t}),a.showAlertMessage()}})},showAlertMessage:function(){var e=this;if(null!==this.refs["alert-message"]){var t=this.refs["alert-message"];$(t).fadeTo(2e3,500).delay(3e3).slideUp(500,function(){e.setState({updateResult:null})})}},deleteFamilyMember:function(e,t,a){var s=this.state.familyMembers;delete s[t],a[e]=e,this.setState({familyMembers:s});var r=this.state.formData,n=this,l=new FormData;for(var i in r)r.hasOwnProperty(i)&&""!==r[i]&&l.append(i,r[i]);l.append("tab","deleteFamilyMember"),l.append("candID",this.state.Data.candID),l.append("familyDCCID",e),$.ajax({type:"POST",url:n.props.action,data:l,cache:!1,contentType:!1,processData:!1,success:function(e){n.setState({updateResult:"success"}),n.showAlertMessage()},error:function(e){if(""!==e.responseText){var t=JSON.parse(e.responseText).message;n.setState({updateResult:"error",errorMessage:t}),n.showAlertMessage()}}})}}),s=React.createFactory(a);window.FamilyInfo=a,window.RFamilyInfo=s,t.default=a}]);
//# sourceMappingURL=familyInfo.js.map