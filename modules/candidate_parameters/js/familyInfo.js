!function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:!1};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.loaded=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.p="",__webpack_require__(0)}([function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var FamilyInfo=React.createClass({displayName:"FamilyInfo",getInitialState:function(){return{Data:[],formData:{},familyMembers:[],updateResult:null,errorMessage:null,isLoaded:!1,loadedData:0}},componentDidMount:function(){var that=this;$.ajax(this.props.dataURL,{dataType:"json",xhr:function xhr(){var xhr=new window.XMLHttpRequest;return xhr.addEventListener("progress",function(evt){that.setState({loadedData:evt.loaded})}),xhr},success:function(data){that.setState({Data:data,isLoaded:!0,familyMembers:data.existingFamilyMembers})},error:function(data,errorCode,errorMsg){that.setState({error:"An error occurred when loading the form!"})}})},setFormData:function(formElement,value){var formData=this.state.formData;formData[formElement]=value,this.setState({formData:formData})},onSubmit:function(e){e.preventDefault()},render:function(){if(!this.state.isLoaded)return void 0!==this.state.error?React.createElement("div",{className:"alert alert-danger text-center"},React.createElement("strong",null,this.state.error)):React.createElement("button",{className:"btn-info has-spinner"},"Loading",React.createElement("span",{className:"glyphicon glyphicon-refresh glyphicon-refresh-animate"}));var relationshipOptions={full_sibling:"Full Sibling",half_sibling:"Half Sibling","1st_cousin":"First Cousin"},disabled=!0,addButton=null;loris.userHasPermission("candidate_parameter_edit")&&(disabled=!1,addButton=React.createElement(ButtonElement,{label:"Add"}));var candidateList=this.state.Data.candidates,familyMembers=this.state.familyMembers,familyMembersHTML=[];for(var key in familyMembers)if(familyMembers.hasOwnProperty(key)){var candID=familyMembers[key].FamilyCandID,relationship=familyMembers[key].Relationship_type,link="?candID="+candID+"&identifier="+candID;familyMembersHTML.push(React.createElement("div",null,React.createElement(StaticElement,{label:"Family Member DCCID",text:React.createElement("a",{href:link},candID)}),React.createElement(StaticElement,{label:"Relation Type",text:relationshipOptions[relationship]}),React.createElement(ButtonElement,{label:"Delete",type:"button",onUserInput:this.deleteFamilyMember.bind(null,candID,key,candidateList)}),React.createElement("hr",null))),delete candidateList[candID]}var relationshipRequired=!1;this.state.formData.FamilyCandID&&(relationshipRequired=!0);var alertMessage="",alertClass="alert text-center hide";if(this.state.updateResult)if("success"===this.state.updateResult)alertClass="alert alert-success text-center",alertMessage="Update Successful!";else if("error"===this.state.updateResult){var errorMessage=this.state.errorMessage;alertClass="alert alert-danger text-center",alertMessage=errorMessage?errorMessage:"Failed to update!"}return React.createElement("div",{className:"row"},React.createElement("div",{className:alertClass,role:"alert",ref:"alert-message"},alertMessage),React.createElement(FormElement,{name:"familyInfo",onSubmit:this.handleSubmit,ref:"form",class:"col-md-6"},React.createElement(StaticElement,{label:"PSCID",text:this.state.Data.pscid}),React.createElement(StaticElement,{label:"DCCID",text:this.state.Data.candID}),React.createElement("hr",null),familyMembersHTML,React.createElement(SelectElement,{label:"Family Member ID (DCCID)",name:"FamilyCandID",options:candidateList,onUserInput:this.setFormData,ref:"FamilyCandID",disabled:disabled,required:!1,value:this.state.formData.FamilyCandID}),React.createElement(SelectElement,{label:"Relation Type",name:"Relationship_type",options:relationshipOptions,onUserInput:this.setFormData,ref:"Relationship_type",disabled:disabled,required:relationshipRequired,value:this.state.formData.Relationship_type}),addButton))},handleSubmit:function(e){e.preventDefault();var myFormData=this.state.formData,self=this,formData=new FormData,formRefs=this.refs,familyMembers=this.state.familyMembers,familyMember={};for(var key in myFormData)myFormData.hasOwnProperty(key)&&""!==myFormData[key]&&(familyMember[key]=myFormData[key],formData.append(key,myFormData[key]));formData.append("tab",this.props.tabName),formData.append("candID",this.state.Data.candID),familyMembers.push(familyMember),this.setState({familyMembers:familyMembers}),$.ajax({type:"POST",url:self.props.action,data:formData,cache:!1,contentType:!1,processData:!1,success:function(data){self.setState({updateResult:"success",formData:{}}),self.showAlertMessage(),Object.keys(formRefs).map(function(ref){formRefs[ref].state&&formRefs[ref].state.value&&(formRefs[ref].state.value="")}),self.forceUpdate()},error:function(err){var errorMessage=JSON.parse(err.responseText).message;self.setState({updateResult:"error",errorMessage:errorMessage}),self.showAlertMessage()}})},showAlertMessage:function(){var self=this;if(null!==this.refs["alert-message"]){var alertMsg=this.refs["alert-message"];$(alertMsg).fadeTo(2e3,500).delay(3e3).slideUp(500,function(){self.setState({updateResult:null})})}},deleteFamilyMember:function(candID,key,candidateList){var familyMembers=this.state.familyMembers;delete familyMembers[key],candidateList[candID]=candID,this.setState({familyMembers:familyMembers});var myFormData=this.state.formData,self=this,formData=new FormData;for(var _key in myFormData)myFormData.hasOwnProperty(_key)&&""!==myFormData[_key]&&formData.append(_key,myFormData[_key]);formData.append("tab","deleteFamilyMember"),formData.append("candID",this.state.Data.candID),formData.append("familyDCCID",candID),$.ajax({type:"POST",url:self.props.action,data:formData,cache:!1,contentType:!1,processData:!1,success:function(data){self.setState({updateResult:"success"}),self.showAlertMessage()},error:function(err){if(""!==err.responseText){var errorMessage=JSON.parse(err.responseText).message;self.setState({updateResult:"error",errorMessage:errorMessage}),self.showAlertMessage()}}})}}),RFamilyInfo=React.createFactory(FamilyInfo);window.FamilyInfo=FamilyInfo,window.RFamilyInfo=RFamilyInfo,exports.default=FamilyInfo}]);
//# sourceMappingURL=familyInfo.js.map